<!DOCTYPE html>
<html lang="ku" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø³ÛŒØ³ØªÛ•Ù…ÛŒ ØªÛ†Ù…Ø§Ø±ÛŒ ØºÛŒØ§Ø¨Ø§Øª Ùˆ Ù…Û†ÚµÛ•Øª - Ù¾Û•ÛŒÙ…Ø§Ù†Ú¯Ø§ÛŒ Ú©Û†Ù…Ù¾ÛŒÙˆØªÛ•Ø±ÛŒ Ø³Ù„ÛÙ…Ø§Ù†ÛŒ</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        :root {
            --primary: #667eea; --primary-dark: #5a6fd8; --secondary: #764ba2;
            --success: #28a745; --info: #17a2b8; --warning: #ffc107; --danger: #dc3545;
            --light: #f8f9fa; --dark: #343a40; --gray: #6c757d; --white: #ffffff;
            --shadow: 0 4px 20px rgba(0,0,0,0.1); --radius: 12px; --transition: all 0.3s ease;
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            min-height: 100vh; display: flex; justify-content: center; align-items: center;
            direction: rtl; padding: 20px; line-height: 1.6;
        }
        .container {
            background: var(--white); padding: 30px; border-radius: var(--radius);
            box-shadow: var(--shadow); width: 100%; max-width: 1200px; animation: slideIn 0.5s ease;
        }
        @keyframes slideIn { from { opacity: 0; transform: translateY(-30px); } to { opacity: 1; transform: translateY(0); } }
        
        .logo-container {
            text-align: center; margin-bottom: 25px; padding: 15px;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            border-radius: 12px; border: 3px solid rgba(102, 126, 234, 0.3);
        }
        .institute-logo {
            width: 800px; height: 120px; object-fit: contain;
            border-radius: 10px; transition: var(--transition);
            border: 2px solid var(--primary);
            box-shadow: 0 6px 25px rgba(0,0,0,0.15);
        }
        .institute-name {
            color: var(--primary); font-size: 28px; font-weight: bold;
            margin-top: 12px; text-shadow: 0 2px 4px rgba(0,0,0,0.1);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        .institute-subtitle {
            color: var(--secondary); font-size: 18px; font-weight: 600;
            margin-top: 5px; font-style: italic;
        }
        .logo-placeholder {
            width: 800px; height: 120px; background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            border-radius: 10px; display: flex; align-items: center; justify-content: center;
            margin: 0 auto; color: white; font-size: 24px; text-align: center;
            border: 3px dashed var(--primary); font-weight: bold;
            flex-direction: column; gap: 8px;
        }
        .logo-placeholder i {
            font-size: 40px;
        }
        
        .header { text-align: center; margin-bottom: 30px; }
        .header h1 { color: var(--primary); font-size: 32px; margin-bottom: 10px; font-weight: 700; }
        .header p { color: var(--gray); font-size: 16px; }
        
        .notification {
            position: fixed; top: 20px; right: 20px; background: var(--white); padding: 20px;
            border-radius: 12px; box-shadow: 0 10px 40px rgba(0,0,0,0.2); min-width: 300px;
            max-width: 400px; z-index: 9999; display: none; animation: slideInRight 0.4s ease;
        }
        @keyframes slideInRight { from { transform: translateX(400px); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
        .notification.success { border-right: 5px solid var(--success); }
        .notification.error { border-right: 5px solid var(--danger); }
        .notification.info { border-right: 5px solid var(--info); }
        .notification.warning { border-right: 5px solid var(--warning); }
        .notification-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        .notification-title { font-weight: bold; font-size: 16px; color: var(--dark); }
        .notification-close { background: none; border: none; font-size: 20px; cursor: pointer; color: var(--gray); }
        .notification-body { color: var(--gray); font-size: 14px; line-height: 1.6; }
        .error-msg {
            background: rgba(220, 53, 69, 0.1); color: var(--danger); padding: 15px; border-radius: 8px;
            margin-bottom: 20px; display: none; text-align: center; border: 1px solid var(--danger); font-weight: 600;
        }
        .form-group { margin-bottom: 20px; }
        .form-group label { display: block; color: var(--dark); font-weight: 600; margin-bottom: 8px; font-size: 14px; }
        .form-group input, .form-group select, .form-group textarea {
            width: 100%; padding: 14px 16px; border: 2px solid #e0e0e0; border-radius: 10px;
            font-size: 16px; transition: var(--transition); background: var(--white);
        }
        .form-group input:focus, .form-group select:focus, .form-group textarea:focus { 
            outline: none; border-color: var(--primary); box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1); 
        }
        .login-btn {
            width: 100%; background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: var(--white); padding: 16px; border: none; border-radius: 10px; font-size: 16px;
            font-weight: 600; cursor: pointer; transition: var(--transition);
        }
        .login-btn:hover { transform: translateY(-2px); box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4); }
        .dashboard { display: none; animation: fadeIn 0.5s ease; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .dashboard-header {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: var(--white); padding: 30px; border-radius: 15px; margin-bottom: 30px;
            text-align: center; box-shadow: var(--shadow);
        }
        .dashboard-header h2 { font-size: 28px; margin-bottom: 10px; font-weight: 700; }
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .stat-card {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%); padding: 25px;
            border-radius: 15px; text-align: center; transition: var(--transition); box-shadow: var(--shadow);
        }
        .stat-card:hover { transform: translateY(-5px); box-shadow: 0 10px 30px rgba(0,0,0,0.15); }
        .stat-number { font-size: 32px; font-weight: bold; color: var(--primary); margin-bottom: 8px; }
        
        .action-section {
            background: var(--white); border-radius: 15px; padding: 25px; margin-bottom: 20px;
            box-shadow: var(--shadow); border: 1px solid rgba(0,0,0,0.05);
        }
        .action-section h3 { color: var(--dark); margin-bottom: 20px; font-size: 22px; }
        .buttons-row { display: flex; flex-wrap: wrap; gap: 10px; margin: 10px 0; }
        .action-btn, .details-btn, .export-btn, .print-btn {
            padding: 14px 24px; border: none; border-radius: 10px; font-size: 16px; font-weight: 600;
            cursor: pointer; transition: var(--transition); display: inline-flex; align-items: center;
            gap: 8px; flex: 1; min-width: 140px; justify-content: center; color: var(--white);
        }
        .action-btn { background: var(--primary); }
        .action-btn:hover { background: var(--primary-dark); transform: translateY(-2px); }
        .details-btn { background: var(--info); }
        .details-btn:hover { background: #138496; transform: translateY(-2px); }
        .export-btn { background: var(--success); }
        .export-btn:hover { background: #218838; transform: translateY(-2px); }
        .print-btn { background: #e44d26; }
        .print-btn:hover { background: #c53c1a; transform: translateY(-2px); }
        .filter-container { margin-bottom: 20px; display: flex; gap: 10px; flex-wrap: wrap; }
        .filter-select {
            padding: 10px 14px; border-radius: 8px; border: 2px solid #e0e0e0;
            font-size: 14px; transition: var(--transition); flex: 1; min-width: 120px;
        }
        .filter-select:focus { outline: none; border-color: var(--primary); }
        .table-container { overflow-x: auto; margin-top: 20px; }
        table { width: 100%; border-collapse: collapse; box-shadow: 0 2px 8px rgba(0,0,0,0.05); border-radius: 10px; overflow: hidden; }
        table th { background: var(--primary); color: var(--white); padding: 14px; text-align: center; font-weight: 600; }
        table td { padding: 14px; text-align: center; border-bottom: 1px solid #eee; }
        table tr:hover { background: #f9f9f9; }
        .logout-btn {
            background: var(--danger); color: var(--white); padding: 14px 30px; border: none;
            border-radius: 10px; font-size: 16px; font-weight: 600; cursor: pointer; margin-top: 20px;
            width: 100%; transition: var(--transition);
        }
        .logout-btn:hover { background: #c82333; transform: translateY(-2px); }
        
        .modal {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.5); justify-content: center; align-items: center; z-index: 1000; padding: 20px;
        }
        .modal-content {
            background: var(--white); padding: 30px; border-radius: 15px; width: 100%;
            max-width: 1200px; max-height: 90vh; overflow-y: auto; box-shadow: 0 10px 50px rgba(0,0,0,0.2);
        }
        .close-btn {
            background: var(--danger); color: var(--white); padding: 8px 16px; border: none;
            border-radius: 8px; cursor: pointer; float: left; font-size: 18px; font-weight: bold;
        }
        .attendance-details-stats { display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin: 20px 0; }
        .detail-stat-card { text-align: center; padding: 20px; border-radius: 12px; border: 2px solid; }
        .detail-stat-present { background: rgba(40, 167, 69, 0.1); border-color: var(--success); }
        .detail-stat-absent { background: rgba(220, 53, 69, 0.1); border-color: var(--danger); }
        .detail-stat-total { background: rgba(23, 162, 184, 0.1); border-color: var(--info); }
        .detail-stat-number { font-size: 36px; font-weight: bold; margin-bottom: 5px; }
        .detail-stat-present .detail-stat-number { color: var(--success); }
        .detail-stat-absent .detail-stat-number { color: var(--danger); }
        .detail-stat-total .detail-stat-number { color: var(--info); }
        .student-list h4 { color: var(--dark); margin-bottom: 15px; padding-bottom: 10px; border-bottom: 2px solid #eee; }
        .student-item {
            display: flex; justify-content: space-between; align-items: center; padding: 15px;
            margin-bottom: 10px; border-radius: 10px; background: #f8f9fa; transition: var(--transition);
        }
        .student-item:hover { background: #e9ecef; transform: translateX(-5px); }
        .student-name { font-weight: bold; color: var(--dark); font-size: 16px; margin-bottom: 5px; }
        .student-details { font-size: 13px; color: var(--gray); }
        .status-badge { padding: 8px 16px; border-radius: 20px; font-weight: bold; font-size: 14px; }
        .status-present { background: rgba(40, 167, 69, 0.15); color: var(--success); }
        .status-absent { background: rgba(220, 53, 69, 0.15); color: var(--danger); }
        .teacher-section { margin-bottom: 25px; padding: 20px; background: #f8f9fa; border-radius: 12px; border: 2px solid #e9ecef; }
        .teacher-header {
            display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;
            padding-bottom: 10px; border-bottom: 2px solid #dee2e6;
        }
        .teacher-name { font-size: 20px; font-weight: bold; color: var(--primary); }
        .class-record { background: var(--white); padding: 15px; margin: 10px 0; border-radius: 8px; border: 1px solid #e9ecef; }
        .absent-count {
            background: rgba(220, 53, 69, 0.15); color: var(--danger); padding: 6px 12px;
            border-radius: 20px; font-weight: bold; font-size: 14px;
        }
        .no-print { display: table-cell; }
        
        .time-breakdown {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        .time-slot-card {
            background: white;
            border-radius: 10px;
            padding: 15px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            border-left: 4px solid var(--primary);
        }
        .time-slot-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            padding-bottom: 8px;
            border-bottom: 1px solid #eee;
        }
        .time-slot-title {
            font-weight: bold;
            color: var(--dark);
        }
        .time-slot-count {
            background: var(--primary);
            color: white;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: bold;
        }
        .time-slot-students {
            max-height: 200px;
            overflow-y: auto;
        }
        .time-student-item {
            padding: 8px 0;
            border-bottom: 1px solid #f5f5f5;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .time-student-name {
            font-size: 14px;
        }
        .time-student-group {
            font-size: 12px;
            color: var(--gray);
        }

        /* Ø²ÛŒØ§Ø¯Ú©Ø±Ø¯Ù†ÛŒ Ø³ØªØ§ÛŒÙ„ÛŒ Ù†ÙˆÛ Ø¨Û† Ú¯Û•Ú•Ø§Ù† */
        .search-container {
            background: var(--white);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: var(--shadow);
            border: 1px solid rgba(0,0,0,0.05);
        }
        
        .search-title {
            color: var(--dark);
            margin-bottom: 15px;
            font-size: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .search-filters {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr auto;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .search-results {
            margin-top: 20px;
        }
        
        .student-card {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: var(--transition);
        }
        
        .student-card:hover {
            background: #e9ecef;
            transform: translateX(-5px);
        }
        
        .student-info h4 {
            margin-bottom: 5px;
            color: var(--dark);
        }
        
        .student-details {
            color: var(--gray);
            font-size: 14px;
        }
        
        .student-actions {
            display: flex;
            gap: 10px;
        }
        
        .action-btn-small {
            padding: 8px 12px;
            border: none;
            border-radius: 6px;
            font-size: 12px;
            cursor: pointer;
            transition: var(--transition);
        }
        
        .view-btn {
            background: var(--info);
            color: white;
        }
        
        .leave-btn {
            background: var(--success);
            color: white;
        }
        
        .now-btn {
            background: var(--warning);
            color: var(--dark);
        }

        /* Ø³ØªØ§ÛŒÙ„ÛŒ Ù†ÙˆÛ Ø¨Û† Ù…Û†Ø¯Ø§Ù„ÛŒ Ú©Û†ÛŒ ØºÛŒØ§Ø¨Ø§Øª */
        .student-absence-card {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 15px;
            border-left: 4px solid var(--danger);
            transition: var(--transition);
        }
        
        .student-absence-card:hover {
            background: #e9ecef;
            transform: translateX(-5px);
        }
        
        .student-absence-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .student-absence-name {
            font-size: 18px;
            font-weight: bold;
            color: var(--dark);
        }
        
        .student-absence-count {
            background: var(--danger);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 20px;
            font-weight: bold;
        }
        
        .student-absence-details {
            color: var(--gray);
            font-size: 14px;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }
        
        .absence-period {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid #dee2e6;
        }
        
        .period-title {
            font-weight: bold;
            color: var(--dark);
            margin-bottom: 8px;
        }
        
        .period-absences {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 8px;
        }
        
        .absence-date {
            background: rgba(220, 53, 69, 0.1);
            color: var(--danger);
            padding: 6px 10px;
            border-radius: 6px;
            font-size: 12px;
            text-align: center;
            font-weight: 600;
        }

        @media print {
            body * { visibility: hidden; }
            .modal-content, .modal-content * { visibility: visible; }
            .modal-content { position: absolute; left: 0; top: 0; width: 100%; background: white; padding: 20px; }
            .no-print { display: none !important; }
        }
        
        @media (max-width: 900px) {
            .institute-logo, .logo-placeholder {
                width: 100%; max-width: 600px; height: 90px;
            }
            .logo-container {
                padding: 12px;
            }
            .institute-name {
                font-size: 24px;
            }
            .institute-subtitle {
                font-size: 16px;
            }
            .logo-placeholder {
                font-size: 20px;
            }
            .search-filters {
                grid-template-columns: 1fr;
            }
            .student-absence-details {
                grid-template-columns: 1fr;
            }
        }
        
        @media (max-width: 768px) {
            .container { padding: 20px 15px; }
            .institute-logo, .logo-placeholder {
                width: 100%; max-width: 500px; height: 70px;
            }
            .logo-container {
                padding: 10px;
            }
            .institute-name {
                font-size: 22px;
            }
            .institute-subtitle {
                font-size: 15px;
            }
            .logo-placeholder {
                font-size: 18px;
            }
            .header h1 { font-size: 24px; }
            .stats-grid { grid-template-columns: 1fr; }
            .buttons-row { flex-direction: column; }
            .action-btn, .details-btn, .export-btn, .print-btn { width: 100%; min-width: auto; }
            .attendance-details-stats { grid-template-columns: 1fr; }
            .filter-container { flex-direction: column; }
            .filter-select { width: 100%; }
            .modal-content { padding: 20px 15px; }
            table { font-size: 14px; }
            table th, table td { padding: 10px 8px; }
            .time-breakdown { grid-template-columns: 1fr; }
            .search-filters {
                grid-template-columns: 1fr;
            }
            .student-absence-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }
        }
        
        @media (max-width: 480px) {
            .institute-logo, .logo-placeholder {
                width: 100%; max-width: 350px; height: 60px;
            }
            .institute-name {
                font-size: 20px;
            }
            .institute-subtitle {
                font-size: 14px;
            }
            .logo-placeholder {
                font-size: 16px;
                flex-direction: column;
                gap: 5px;
            }
            .logo-placeholder i {
                font-size: 30px;
            }
            .student-actions {
                flex-direction: column;
            }
            .period-absences {
                grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            }
        }
    </style>
</head>
<body>
    <div id="notification" class="notification">
        <div class="notification-header">
            <span class="notification-title" id="notificationTitle">Ø¦Ø§Ú¯Ø§Ø¯Ø§Ø±ÛŒÚ©Ø±Ø¯Ù†Û•ÙˆÛ•</span>
            <button class="notification-close" onclick="closeNotification()">&times;</button>
        </div>
        <div class="notification-body" id="notificationBody"></div>
    </div>

    <div id="loginPage" class="container">
        <div class="header">
          <div class="logo-container">
    <div id="loginLogoContainer">
        <img src="https://raw.githubusercontent.com/cis-web/CIS-SUL-APP/main/cis-web/logo.png" 
             alt="Ù„Û†Ú¯Û†ÛŒ Ù¾Û•ÛŒÙ…Ø§Ù†Ú¯Ø§ÛŒ Ú©Û†Ù…Ù¾ÛŒÙˆØªÛ•Ø±ÛŒ Ø³Ù„ÛÙ…Ø§Ù†ÛŒ" 
             class="institute-logo" 
             id="loginLogo"
             onerror="this.style.display='none'; document.getElementById('loginLogoPlaceholder').style.display='flex';">
        
        <div id="loginLogoPlaceholder" class="logo-placeholder" style="display: none;">
            <i class="fas fa-graduation-cap"></i>
            <span>Ù¾Û•ÛŒÙ…Ø§Ù†Ú¯Ø§ÛŒ Ú©Û†Ù…Ù¾ÛŒÙˆØªÛ•Ø±ÛŒ Ø³Ù„ÛÙ…Ø§Ù†ÛŒ</span>
        </div>
    </div>
    <div class="institute-name">Ù¾Û•ÛŒÙ…Ø§Ù†Ú¯Ø§ÛŒ Ú©Û†Ù…Ù¾ÛŒÙˆØªÛ•Ø±ÛŒ Ø³Ù„ÛÙ…Ø§Ù†ÛŒ</div>
    <div class="institute-subtitle">Slemani Computer Institute</div>
</div>
            <h1>ğŸ“ Ø³ÛŒØ³ØªÛ•Ù…ÛŒ Ø¯Ø§Ø´Ø¨Û†Ø±Ø¯ÛŒ ØªÛ†Ù…Ø§Ø±ÛŒ ØºÛŒØ§Ø¨Ø§Øª Ùˆ Ù…Û†ÚµÛ•Øª</h1>
            <p>ØªÚ©Ø§ÛŒÛ• Ø¨Û• Ú˜ÙˆÙˆØ±Û•ÙˆÛ• Ø¨Û• Ø³ÛŒØ³ØªÛ•Ù…ÛŒ Ø¨Û•Ú•ÛÙˆÛ•Ø¨Ø±Ø¯Ù†ÛŒ ØºÛŒØ§Ø¨Ø§Øª</p>
        </div>
        <div class="error-msg" id="errorMsg">Ù†Ø§ÙˆÛŒ Ø¨Û•Ú©Ø§Ø±Ù‡ÛÙ†Û•Ø± ÛŒØ§Ù† ÙˆØ´Û•ÛŒ Ù†Ù‡ÛÙ†ÛŒ Ù‡Û•ÚµÛ•ÛŒÛ•!</div>
        <form onsubmit="handleLogin(event)">
            <div class="form-group">
                <label>Ù†Ø§ÙˆÛŒ Ø¨Û•Ú©Ø§Ø±Ù‡ÛÙ†Û•Ø±</label>
                <input type="text" id="username" required>
            </div>
            <div class="form-group">
                <label>ÙˆØ´Û•ÛŒ Ù†Ù‡ÛÙ†ÛŒ</label>
                <input type="password" id="password" required>
            </div>
            <button type="submit" class="login-btn">Ú†ÙˆÙˆÙ†Û•Ú˜ÙˆÙˆØ±Û•ÙˆÛ•</button>
        </form>
    </div>

    <div id="staffDashboard" class="container dashboard">
        <div class="logo-container">
            <div id="dashboardLogoContainer">
                <img src="https://raw.githubusercontent.com/cis-web/CIS-SUL-APP/main/cis-web/logo.png" alt="Ù„Û†Ú¯Û†ÛŒ Ù¾Û•ÛŒÙ…Ø§Ù†Ú¯Ø§ÛŒ Ú©Û†Ù…Ù¾ÛŒÙˆØªÛ•Ø±ÛŒ Ø³Ù„ÛÙ…Ø§Ù†ÛŒ" class="institute-logo" id="dashboardLogo">
            </div>
            <div class="institute-name">Ù¾Û•ÛŒÙ…Ø§Ù†Ú¯Ø§ÛŒ Ú©Û†Ù…Ù¾ÛŒÙˆØªÛ•Ø±ÛŒ Ø³Ù„ÛÙ…Ø§Ù†ÛŒ</div>
            <div class="institute-subtitle">Slemani Computer Institute</div>
        </div>
        
        <div class="dashboard-header">
            <h2>ğŸ“Š Ø¯Ø§Ø´Ø¨Û†Ø±Ø¯ÛŒ Ú©Ø§Ø±Ù…Û•Ù†Ø¯ÛŒ ØªÛ†Ù…Ø§Ø±ÛŒ ØºÛŒØ§Ø¨Ø§Øª</h2>
            <p id="staffWelcome">Ø¨Û•Ø®ÛØ±Ø¨ÛÛŒØª</p>
        </div>
        
        <div class="stats-grid">
            <div class="stat-card"><div class="stat-number" id="totalRecords">0</div><div>Ú©Û†ÛŒ ØªÛ†Ù…Ø§Ø±Û•Ú©Ø§Ù†</div></div>
            <div class="stat-card"><div class="stat-number" id="totalPresent">0</div><div>Ø¦Ø§Ù…Ø§Ø¯Û•</div></div>
            <div class="stat-card"><div class="stat-number" id="totalAbsent">0</div><div>ØºÛŒØ§Ø¨</div></div>
        </div>
        
        <div class="action-section">
            <h3>Ú©Ø±Ø¯Ø§Ø±Û•Ú©Ø§Ù†</h3>
            
            <!-- Ø²ÛŒØ§Ø¯Ú©Ø±Ø¯Ù†ÛŒ Ø¯ÙˆÚ¯Ù…Û•ÛŒ Ù†ÙˆÛ Ø¨Û† Ú©Û†ÛŒ ØºÛŒØ§Ø¨Ø§ØªÛŒ Ø®ÙˆÛÙ†Ø¯Ú©Ø§Ø± -->
            <div class="buttons-row">
                <button class="action-btn" onclick="viewTodayAttendance()">ğŸ“… ØºÛŒØ§Ø¨Ø§ØªÛŒ Ø¦Û•Ù…Ú•Û†</button>
                <button class="action-btn" onclick="viewTeachersAttendance()" style="background: var(--info);">ğŸ‘¨â€ğŸ« Ù…Ø§Ù…Û†Ø³ØªØ§ÛŒØ§Ù†ÛŒ Ø¦Û•Ù…Ú•Û†</button>
                <button class="action-btn" onclick="viewTimeAnalysis()" style="background: var(--warning); color: var(--dark);">â° Ø´ÛŒÚ©Ø§Ø±ÛŒ Ú©Ø§ØªÛŒ ØºÛŒØ§Ø¨Ø§Øª</button>
            </div>
            
            <div class="buttons-row">
                <button class="action-btn" onclick="openLeaveModal()" style="background: var(--success);">ğŸ–ï¸ Ø²ÛŒØ§Ø¯Ú©Ø±Ø¯Ù†ÛŒ Ù…Û†ÚµÛ•Øª</button>
                <button class="action-btn" onclick="openNowAttendanceModal()" style="background: #e44d26;">â±ï¸ ØªÛ†Ù…Ø§Ø±ÛŒ Ø¦ÛØ³ØªØ§</button>
            </div>
            
            <div class="buttons-row">
                <button class="action-btn" onclick="viewLeaveRecords()" style="background: var(--secondary);">ğŸ“‹ Ø¨ÛŒÙ†ÛŒÙ†ÛŒ Ù…Û†ÚµÛ•ØªÛ•Ú©Ø§Ù†</button>
                <button class="action-btn" onclick="openStudentSearch()" style="background: #6f42c1;">ğŸ” Ú¯Û•Ú•Ø§Ù†ÛŒ Ø®ÙˆÛÙ†Ø¯Ú©Ø§Ø±</button>
                <button class="action-btn" onclick="openStudentAbsenceModal()" style="background: #dc3545;">ğŸ“Š Ú©Û†ÛŒ ØºÛŒØ§Ø¨Ø§ØªÛŒ Ø®ÙˆÛÙ†Ø¯Ú©Ø§Ø±</button>
            </div>
            
            <div class="buttons-row">
                <button class="details-btn" onclick="viewTotalStudentAbsence()">ğŸ“Š Ú©Û†ÛŒ Ú¯Ø´ØªÛŒ ØºÛŒØ§Ø¨Ø§Øª</button>
                <button class="export-btn" onclick="viewDetailedAbsence()" style="background: var(--secondary);">ğŸ“‹ ÙˆØ±Ø¯Û•Ú©Ø§Ø±ÛŒ ØºÛŒØ§Ø¨Ø§ØªÛ•Ú©Ø§Ù†</button>
            </div>
            
            <div class="buttons-row">
                <button class="details-btn" onclick="refreshData()" style="background: var(--warning); color: var(--dark);">ğŸ”„ Ù†ÙˆÛÚ©Ø±Ø¯Ù†Û•ÙˆÛ•</button>
            </div>
            
            <div class="filter-container">
                <input type="date" id="filterDate" class="filter-select" onchange="loadAttendanceData()">
                <select id="filterLevel" onchange="loadAttendanceData()" class="filter-select">
                    <option value="">Ù‡Û•Ù…ÙˆÙˆ Ø¦Ø§Ø³ØªÛ•Ú©Ø§Ù†</option>
                    <option value="1">Ø¦Ø§Ø³ØªÛŒ 1</option>
                    <option value="2">Ø¦Ø§Ø³ØªÛŒ 2</option>
                    <option value="3">Ø¦Ø§Ø³ØªÛŒ 3</option>
                    <option value="4">Ø¦Ø§Ø³ØªÛŒ 4</option>
                    <option value="5">Ø¦Ø§Ø³ØªÛŒ 5</option>
                </select>
                <select id="filterGroup" onchange="loadAttendanceData()" class="filter-select">
                    <option value="">Ù‡Û•Ù…ÙˆÙˆ Ú¯Ø±ÙˆÙˆÙ¾Û•Ú©Ø§Ù†</option>
                    <option value="A">Ú¯Ø±ÙˆÙˆÙ¾ÛŒ A</option>
                    <option value="B">Ú¯Ø±ÙˆÙˆÙ¾ÛŒ B</option>
                    <option value="C">Ú¯Ø±ÙˆÙˆÙ¾ÛŒ C</option>
                    <option value="D">Ú¯Ø±ÙˆÙˆÙ¾ÛŒ D</option>
                    <option value="E">Ú¯Ø±ÙˆÙˆÙ¾ÛŒ E</option>
                    <option value="WEB">Ú¯Ø±ÙˆÙˆÙ¾ÛŒ WEB</option>
                    <option value="NET">Ú¯Ø±ÙˆÙˆÙ¾ÛŒ NET</option>
                    <option value="PRO">Ú¯Ø±ÙˆÙˆÙ¾ÛŒ PRO</option>
                </select>
            </div>
            
            <div class="buttons-row">
                <button class="export-btn" onclick="exportTodayToExcel()">ğŸ“¥ Ù‡Û•Ù†Ø§Ø±Ø¯Û• Ø¨Û† Excel</button>
                <button class="print-btn" onclick="printTodayAttendance()">ğŸ–¨ï¸ Ú†Ø§Ù¾Ú©Ø±Ø¯Ù†</button>
            </div>
            
            <div class="table-container">
                <table id="todayAttendanceTable">
                    <thead>
                        <tr>
                            <th>Ø¨Û•Ø±ÙˆØ§Ø±</th><th>Ù…Ø§Ù…Û†Ø³ØªØ§</th><th>ÙˆØ§Ù†Û•</th><th>Ø¦Ø§Ø³Øª</th><th>Ú¯Ø±ÙˆÙˆÙ¾</th>
                            <th>Ú©Ø§Øª</th><th>Ø¦Ø§Ù…Ø§Ø¯Û•</th><th>ØºÛŒØ§Ø¨</th><th class="no-print">Ú©Ø±Ø¯Ø§Ø±Û•Ú©Ø§Ù†</th>
                        </tr>
                    </thead>
                    <tbody id="attendanceTableBody">
                        <tr><td colspan="9" style="padding: 40px;">ØªÚ©Ø§ÛŒÛ• ÙÙ„ØªÛ•Ø± Ù‡Û•ÚµØ¨Ú˜ÛØ±Û•</td></tr>
                    </tbody>
                </table>
            </div>
        </div>
        
        <button class="logout-btn" onclick="logout()">Ø¯Û•Ø±Ú†ÙˆÙˆÙ†</button>
        
        <div style="text-align: center; margin-top: 30px; padding: 20px; background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%); border-radius: 12px;">
            <div style="color: var(--dark); font-size: 16px; font-weight: 600; margin-bottom: 8px;">ğŸ‘¨â€ğŸ’» Ø¯Ø±ÙˆØ³ØªÚ©Û•Ø±</div>
            <div style="color: var(--primary); font-size: 18px; font-weight: bold; margin-bottom: 8px;">Ù…Ø§Ø¬Ø¯ Ø§Ù†ÙˆØ±</div>
            <div style="color: var(--gray); font-size: 14px;">
                <i class="fas fa-phone"></i>
                <a href="tel:07701458474" style="color: var(--info); text-decoration: none; font-weight: 600;">Ù Ù§Ù§Ù Ù¡Ù¤Ù¥Ù¨Ù¤Ù§Ù¤</a>
            </div>
        </div>
    </div>

    <!-- Ù…Û†Ø¯Ø§Ù„Û•Ú©Ø§Ù† -->
    <div id="detailsModal" class="modal">
        <div class="modal-content">
            <button class="close-btn" onclick="closeDetailsModal()">&times;</button>
            <h2 style="clear: both; margin-bottom: 20px;" id="detailsTitle">ÙˆØ±Ø¯Û•Ú©Ø§Ø±ÛŒ Ø¦Ø§Ù…Ø§Ø¯Û•Ø¨ÙˆÙˆÙ†</h2>
            <div class="attendance-details-stats">
                <div class="detail-stat-card detail-stat-present"><div class="detail-stat-number" id="detailPresent">0</div><div>Ø¦Ø§Ù…Ø§Ø¯Û•</div></div>
                <div class="detail-stat-card detail-stat-absent"><div class="detail-stat-number" id="detailAbsent">0</div><div>ØºÛŒØ§Ø¨</div></div>
                <div class="detail-stat-card detail-stat-total"><div class="detail-stat-number" id="detailTotal">0</div><div>Ú©Û†ÛŒ Ú¯Ø´ØªÛŒ</div></div>
            </div>
            <div id="studentListContainer"></div>
        </div>
    </div>

    <div id="totalAbsenceModal" class="modal">
        <div class="modal-content">
            <button class="close-btn" onclick="closeAbsenceModal()">&times;</button>
            <h2 style="clear: both; margin-bottom: 20px;">Ú©Û†ÛŒ Ú¯Ø´ØªÛŒ ØºÛŒØ§Ø¨Ø§ØªÛŒ Ø®ÙˆÛÙ†Ø¯Ú©Ø§Ø±Ø§Ù†</h2>
            <div class="filter-container">
                <input type="date" id="startDate" class="filter-select">
                <input type="date" id="endDate" class="filter-select">
                <button class="action-btn" onclick="loadAbsenceData()">ğŸ” Ú¯Û•Ú•Ø§Ù†</button>
                <button class="export-btn" onclick="exportAbsence()">ğŸ“¥ Excel</button>
                <button class="print-btn" onclick="printAbsenceData()">ğŸ–¨ï¸ Ú†Ø§Ù¾</button>
            </div>
            <div class="table-container">
                <table id="totalAbsenceTable">
                    <thead><tr><th>Ù†Ø§ÙˆÛŒ Ø®ÙˆÛÙ†Ø¯Ú©Ø§Ø±</th><th>Ù¾Û•ÛŒÙ…Ø§Ù†Ú¯Û•</th><th>Ø¦Ø§Ø³Øª</th><th>Ú¯Ø±ÙˆÙ¾</th><th>Ú©Û†ÛŒ ØºÛŒØ§Ø¨Ø§Øª</th></tr></thead>
                    <tbody id="absenceTableBody"><tr><td colspan="5" style="padding: 40px;">ØªÚ©Ø§ÛŒÛ• Ø¨Û•Ø±ÙˆØ§Ø± Ù‡Û•ÚµØ¨Ú˜ÛØ±Û•</td></tr></tbody>
                </table>
            </div>
        </div>
    </div>

    <div id="detailedAbsenceModal" class="modal">
        <div class="modal-content">
            <button class="close-btn" onclick="closeDetailedAbsenceModal()">&times;</button>
            <h2 style="clear: both; margin-bottom: 20px;">ÙˆØ±Ø¯Û•Ú©Ø§Ø±ÛŒ ØºÛŒØ§Ø¨Ø§ØªÛ•Ú©Ø§Ù†</h2>
            <div class="filter-container">
                <input type="date" id="detailedStartDate" class="filter-select">
                <input type="date" id="detailedEndDate" class="filter-select">
                <select id="detailedLevel" class="filter-select">
                    <option value="">Ù‡Û•Ù…ÙˆÙˆ Ø¦Ø§Ø³ØªÛ•Ú©Ø§Ù†</option>
                    <option value="1">Ø¦Ø§Ø³ØªÛŒ 1</option>
                    <option value="2">Ø¦Ø§Ø³ØªÛŒ 2</option>
                    <option value="3">Ø¦Ø§Ø³ØªÛŒ 3</option>
                    <option value="4">Ø¦Ø§Ø³ØªÛŒ 4</option>
                    <option value="5">Ø¦Ø§Ø³ØªÛŒ 5</option>
                </select>
                <select id="detailedGroup" class="filter-select">
                    <option value="">Ù‡Û•Ù…ÙˆÙˆ Ú¯Ø±ÙˆÙˆÙ¾Û•Ú©Ø§Ù†</option>
                    <option value="A">Ú¯Ø±ÙˆÙˆÙ¾ÛŒ A</option>
                    <option value="B">Ú¯Ø±ÙˆÙˆÙ¾ÛŒ B</option>
                    <option value="C">Ú¯Ø±ÙˆÙˆÙ¾ÛŒ C</option>
                    <option value="D">Ú¯Ø±ÙˆÙˆÙ¾ÛŒ D</option>
                    <option value="E">Ú¯Ø±ÙˆÙˆÙ¾ÛŒ E</option>
                    <option value="WEB">Ú¯Ø±ÙˆÙˆÙ¾ÛŒ WEB</option>
                    <option value="NET">Ú¯Ø±ÙˆÙˆÙ¾ÛŒ NET</option>
                    <option value="PRO">Ú¯Ø±ÙˆÙˆÙ¾ÛŒ PRO</option>
                </select>
                <button class="action-btn" onclick="loadDetailedAbsence()">ğŸ” Ú¯Û•Ú•Ø§Ù†</button>
                <button class="export-btn" onclick="exportDetailedAbsence()">ğŸ“¥ Excel</button>
                <button class="print-btn" onclick="printDetailedAbsence()">ğŸ–¨ï¸ Ú†Ø§Ù¾</button>
            </div>
            <div class="table-container">
                <table id="detailedAbsenceTable">
                    <thead>
                        <tr>
                            <th>Ù†Ø§ÙˆÛŒ Ø®ÙˆÛÙ†Ø¯Ú©Ø§Ø±</th><th>Ú©Û†Ø¯</th><th>Ù¾Û•ÛŒÙ…Ø§Ù†Ú¯Û•</th><th>Ø¦Ø§Ø³Øª</th><th>Ú¯Ø±ÙˆÙ¾</th>
                            <th>Ø¨Û•Ø±ÙˆØ§Ø±</th><th>ÙˆØ§Ù†Û•</th><th>Ù…Ø§Ù…Û†Ø³ØªØ§</th><th>Ú©Ø§Øª</th>
                        </tr>
                    </thead>
                    <tbody id="detailedAbsenceTableBody">
                        <tr><td colspan="9" style="padding: 40px;">ØªÚ©Ø§ÛŒÛ• ÙÙ„ØªÛ•Ø±Û•Ú©Ø§Ù† Ù‡Û•ÚµØ¨Ú˜ÛØ±Û•</td></tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <div id="teachersModal" class="modal">
        <div class="modal-content">
            <button class="close-btn" onclick="closeTeachersModal()">&times;</button>
            <h2 style="clear: both; margin-bottom: 20px;">Ù…Ø§Ù…Û†Ø³ØªØ§ÛŒØ§Ù†ÛŒ Ø¦Û•Ù…Ú•Û†</h2>
            <div class="attendance-details-stats">
                <div class="detail-stat-card detail-stat-total"><div class="detail-stat-number" id="totalTeachers">0</div><div>Ú©Û†ÛŒ Ù…Ø§Ù…Û†Ø³ØªØ§Ú©Ø§Ù†</div></div>
                <div class="detail-stat-card detail-stat-present"><div class="detail-stat-number" id="totalRecordsToday">0</div><div>Ú©Û†ÛŒ ØªÛ†Ù…Ø§Ø±Û•Ú©Ø§Ù†</div></div>
                <div class="detail-stat-card detail-stat-absent"><div class="detail-stat-number" id="totalAbsencesToday">0</div><div>Ú©Û†ÛŒ ØºÛŒØ§Ø¨Ø§Øª</div></div>
            </div>
            <div class="buttons-row" style="margin-bottom: 20px;">
                <button class="print-btn" onclick="printTeachersToday()">ğŸ–¨ï¸ Ú†Ø§Ù¾ÛŒ Ù…Ø§Ù…Û†Ø³ØªØ§ÛŒØ§Ù†ÛŒ Ø¦Û•Ù…Ú•Û†</button>
            </div>
            <div id="teachersListContainer"></div>
        </div>
    </div>

    <div id="timeAnalysisModal" class="modal">
        <div class="modal-content">
            <button class="close-btn" onclick="closeTimeAnalysisModal()">&times;</button>
            <h2 style="clear: both; margin-bottom: 20px;">Ø´ÛŒÚ©Ø§Ø±ÛŒ ØºÛŒØ§Ø¨Ø§Øª Ø¨Û•Ù¾ÛÛŒ Ú©Ø§Øª</h2>
            
            <div class="filter-container">
                <input type="date" id="timeAnalysisDate" class="filter-select" value="">
                <select id="timeAnalysisLevel" class="filter-select">
                    <option value="">Ù‡Û•Ù…ÙˆÙˆ Ø¦Ø§Ø³ØªÛ•Ú©Ø§Ù†</option>
                    <option value="1">Ø¦Ø§Ø³ØªÛŒ 1</option>
                    <option value="2">Ø¦Ø§Ø³ØªÛŒ 2</option>
                    <option value="3">Ø¦Ø§Ø³ØªÛŒ 3</option>
                    <option value="4">Ø¦Ø§Ø³ØªÛŒ 4</option>
                    <option value="5">Ø¦Ø§Ø³ØªÛŒ 5</option>
                </select>
                <select id="timeAnalysisGroup" class="filter-select">
                    <option value="">Ù‡Û•Ù…ÙˆÙˆ Ú¯Ø±ÙˆÙˆÙ¾Û•Ú©Ø§Ù†</option>
                    <option value="A">Ú¯Ø±ÙˆÙˆÙ¾ÛŒ A</option>
                    <option value="B">Ú¯Ø±ÙˆÙˆÙ¾ÛŒ B</option>
                    <option value="C">Ú¯Ø±ÙˆÙˆÙ¾ÛŒ C</option>
                    <option value="D">Ú¯Ø±ÙˆÙˆÙ¾ÛŒ D</option>
                    <option value="E">Ú¯Ø±ÙˆÙˆÙ¾ÛŒ E</option>
                    <option value="WEB">Ú¯Ø±ÙˆÙˆÙ¾ÛŒ WEB</option>
                    <option value="NET">Ú¯Ø±ÙˆÙˆÙ¾ÛŒ NET</option>
                    <option value="PRO">Ú¯Ø±ÙˆÙˆÙ¾ÛŒ PRO</option>
                </select>
                <button class="action-btn" onclick="loadTimeAnalysisData()">ğŸ” Ú¯Û•Ú•Ø§Ù†</button>
                <button class="export-btn" onclick="exportTimeAnalysis()">ğŸ“¥ Excel</button>
                <button class="print-btn" onclick="printTimeAnalysis()">ğŸ–¨ï¸ Ú†Ø§Ù¾</button>
            </div>
            
            <div class="attendance-details-stats">
                <div class="detail-stat-card detail-stat-total"><div class="detail-stat-number" id="totalTimeAbsences">0</div><div>Ú©Û†ÛŒ ØºÛŒØ§Ø¨Ø§Øª</div></div>
                <div class="detail-stat-card detail-stat-present"><div class="detail-stat-number" id="totalTimeSlots">0</div><div>Ú©Û†ÛŒ Ú©Ø§ØªÛ•Ú©Ø§Ù†</div></div>
                <div class="detail-stat-card detail-stat-absent"><div class="detail-stat-number" id="peakAbsenceTime">-</div><div>Ú©Ø§ØªÛŒ Ø²Û†Ø±ØªØ±ÛŒÙ† ØºÛŒØ§Ø¨</div></div>
            </div>
            
            <div id="timeBreakdownContainer" class="time-breakdown"></div>
        </div>
    </div>

    <!-- Ù…Û†Ø¯Ø§Ù„ÛŒ Ø²ÛŒØ§Ø¯Ú©Ø±Ø¯Ù†ÛŒ Ù…Û†ÚµÛ•Øª -->
    <div id="leaveModal" class="modal">
        <div class="modal-content">
            <button class="close-btn" onclick="closeLeaveModal()">&times;</button>
            <h2 style="clear: both; margin-bottom: 20px;">ğŸ–ï¸ Ø²ÛŒØ§Ø¯Ú©Ø±Ø¯Ù†ÛŒ Ù…Û†ÚµÛ•ØªÛŒ Ø®ÙˆÛÙ†Ø¯Ú©Ø§Ø±</h2>
            
            <form onsubmit="submitLeave(event)" style="max-width: 600px; margin: 0 auto;">
                <div class="form-group">
                    <label>Ø¦Ø§Ø³Øª Ùˆ Ú¯Ø±ÙˆÙ¾</label>
                    <select id="leaveLevelGroup" class="filter-select" required style="width: 100%; padding: 14px;" onchange="filterStudentsByLevelGroup()">
                        <option value="">Ø¦Ø§Ø³Øª Ùˆ Ú¯Ø±ÙˆÙ¾ÛÚ© Ù‡Û•ÚµØ¨Ú˜ÛØ±Û•</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>Ù†Ø§ÙˆÛŒ Ø®ÙˆÛÙ†Ø¯Ú©Ø§Ø±</label>
                    <select id="leaveStudentId" class="filter-select" required style="width: 100%; padding: 14px;">
                        <option value="">ÛŒÛ•Ú©Û•Ù… Ø¦Ø§Ø³Øª Ùˆ Ú¯Ø±ÙˆÙ¾ Ù‡Û•ÚµØ¨Ú˜ÛØ±Û•</option>
                    </select>
                </div>
                
                <div class="form-group" style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                    <div>
                        <label>Ø¨Û•Ø±ÙˆØ§Ø±ÛŒ Ø¯Û•Ø³ØªÙ¾ÛÚ©</label>
                        <input type="date" id="leaveStartDate" required>
                    </div>
                    <div>
                        <label>Ø¨Û•Ø±ÙˆØ§Ø±ÛŒ Ú©Û†ØªØ§ÛŒÛŒ</label>
                        <input type="date" id="leaveEndDate" required>
                    </div>
                </div>
                
                <div class="form-group">
                    <label>Ù‡Û†Ú©Ø§Ø±ÛŒ Ù…Û†ÚµÛ•Øª</label>
                    <select id="leaveReason" class="filter-select" required style="width: 100%; padding: 14px;">
                        <option value="">Ù‡Û†Ú©Ø§Ø±ÛÚ© Ù‡Û•ÚµØ¨Ú˜ÛØ±Û•</option>
                        <option value="Ù†Û•Ø®Û†Ø´ÛŒ">Ù†Û•Ø®Û†Ø´ÛŒ</option>
                        <option value="Ú©ÛØ´Û•ÛŒ ØªØ§ÛŒØ¨Û•Øª">Ú©ÛØ´Û•ÛŒ ØªØ§ÛŒØ¨Û•Øª</option>
                        <option value="Ú¯Û•Ø´ØªÛŒ Ø®ÛØ²Ø§Ù†ÛŒ">Ú¯Û•Ø´ØªÛŒ Ø®ÛØ²Ø§Ù†ÛŒ</option>
                        <option value="Ù…Û†ÚµÛ•ØªÛŒ ÙÛ•Ø±Ù…ÛŒ">Ù…Û†ÚµÛ•ØªÛŒ ÙÛ•Ø±Ù…ÛŒ</option>
                        <option value="Ù‡Û†Ú©Ø§Ø±ÛŒ Ø¯ÛŒÚ©Û•">Ù‡Û†Ú©Ø§Ø±ÛŒ Ø¯ÛŒÚ©Û•</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>ØªÛØ¨ÛŒÙ†ÛŒ (Ø¦Û•Ú¯Û•Ø± Ù‡Û•Ø¨ÛØª)</label>
                    <textarea id="leaveNotes" rows="3" style="width: 100%; padding: 14px; border: 2px solid #e0e0e0; border-radius: 10px; font-family: inherit; resize: vertical;"></textarea>
                </div>
                
                <div class="form-group">
                    <label>Ú©Ø§Ø±Ù…Û•Ù†Ø¯ÛŒ ØªÛ†Ù…Ø§Ø±Ø¯Ø§Ø±</label>
                    <input type="text" id="leaveRecordedBy" value="" required>
                </div>
                
                <div class="buttons-row">
                    <button type="submit" class="action-btn" style="background: var(--success);">âœ… ØªÛ†Ù…Ø§Ø±Ú©Ø±Ø¯Ù†</button>
                    <button type="button" class="action-btn" onclick="closeLeaveModal()" style="background: var(--gray);">âŒ Ù¾Ø§Ø´Ú¯Û•Ø²Ø¨ÙˆÙˆÙ†Û•ÙˆÛ•</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Ù…Û†Ø¯Ø§Ù„ÛŒ Ø¨ÛŒÙ†ÛŒÙ†ÛŒ Ù…Û†ÚµÛ•ØªÛ•Ú©Ø§Ù† -->
    <div id="leavesViewModal" class="modal">
        <div class="modal-content">
            <button class="close-btn" onclick="closeLeavesViewModal()">&times;</button>
            <h2 style="clear: both; margin-bottom: 20px;">ğŸ“‹ ØªÛ†Ù…Ø§Ø±Û•Ú©Ø§Ù†ÛŒ Ù…Û†ÚµÛ•Øª</h2>
            
            <div class="filter-container">
                <input type="date" id="leaveFilterStartDate" class="filter-select">
                <input type="date" id="leaveFilterEndDate" class="filter-select">
                <select id="leaveFilterLevel" class="filter-select">
                    <option value="">Ù‡Û•Ù…ÙˆÙˆ Ø¦Ø§Ø³ØªÛ•Ú©Ø§Ù†</option>
                    <option value="1">Ø¦Ø§Ø³ØªÛŒ 1</option>
                    <option value="2">Ø¦Ø§Ø³ØªÛŒ 2</option>
                    <option value="3">Ø¦Ø§Ø³ØªÛŒ 3</option>
                    <option value="4">Ø¦Ø§Ø³ØªÛŒ 4</option>
                    <option value="5">Ø¦Ø§Ø³ØªÛŒ 5</option>
                </select>
                <select id="leaveFilterGroup" class="filter-select">
                    <option value="">Ù‡Û•Ù…ÙˆÙˆ Ú¯Ø±ÙˆÙˆÙ¾Û•Ú©Ø§Ù†</option>
                    <option value="A">Ú¯Ø±ÙˆÙˆÙ¾ÛŒ A</option>
                    <option value="B">Ú¯Ø±ÙˆÙˆÙ¾ÛŒ B</option>
                    <option value="C">Ú¯Ø±ÙˆÙˆÙ¾ÛŒ C</option>
                    <option value="D">Ú¯Ø±ÙˆÙˆÙ¾ÛŒ D</option>
                    <option value="E">Ú¯Ø±ÙˆÙˆÙ¾ÛŒ E</option>
                    <option value="WEB">Ú¯Ø±ÙˆÙˆÙ¾ÛŒ WEB</option>
                    <option value="NET">Ú¯Ø±ÙˆÙˆÙ¾ÛŒ NET</option>
                    <option value="PRO">Ú¯Ø±ÙˆÙˆÙ¾ÛŒ PRO</option>
                </select>
                <button class="action-btn" onclick="loadLeaveRecords()">ğŸ” Ú¯Û•Ú•Ø§Ù†</button>
                <button class="export-btn" onclick="exportLeaves()">ğŸ“¥ Excel</button>
                <button class="print-btn" onclick="printLeaves()">ğŸ–¨ï¸ Ú†Ø§Ù¾</button>
            </div>
            
            <div class="attendance-details-stats">
                <div class="detail-stat-card detail-stat-total"><div class="detail-stat-number" id="totalLeaves">0</div><div>Ú©Û†ÛŒ Ù…Û†ÚµÛ•ØªÛ•Ú©Ø§Ù†</div></div>
                <div class="detail-stat-card detail-stat-present"><div class="detail-stat-number" id="activeLeaves">0</div><div>Ù…Û†ÚµÛ•ØªÛŒ Ú†Ø§Ù„Ø§Ú©</div></div>
                <div class="detail-stat-card detail-stat-absent"><div class="detail-stat-number" id="totalLeaveDays">0</div><div>Ú©Û†ÛŒ Ú•Û†Ú˜Û•Ú©Ø§Ù†</div></div>
            </div>
            
            <div class="table-container">
                <table id="leavesTable">
                    <thead>
                        <tr>
                            <th>Ù†Ø§ÙˆÛŒ Ø®ÙˆÛÙ†Ø¯Ú©Ø§Ø±</th>
                            <th>Ù¾Û•ÛŒÙ…Ø§Ù†Ú¯Û•</th>
                            <th>Ø¦Ø§Ø³Øª</th>
                            <th>Ú¯Ø±ÙˆÙ¾</th>
                            <th>Ø¨Û•Ø±ÙˆØ§Ø±ÛŒ Ø¯Û•Ø³ØªÙ¾ÛÚ©</th>
                            <th>Ø¨Û•Ø±ÙˆØ§Ø±ÛŒ Ú©Û†ØªØ§ÛŒÛŒ</th>
                            <th>Ú˜Ù…Ø§Ø±Û•ÛŒ Ú•Û†Ú˜Û•Ú©Ø§Ù†</th>
                            <th>Ù‡Û†Ú©Ø§Ø±</th>
                            <th>ØªÛØ¨ÛŒÙ†ÛŒ</th>
                            <th>Ú©Ø§Ø±Ù…Û•Ù†Ø¯</th>
                            <th class="no-print">Ú©Ø±Ø¯Ø§Ø±Û•Ú©Ø§Ù†</th>
                        </tr>
                    </thead>
                    <tbody id="leavesTableBody">
                        <tr><td colspan="11" style="padding: 40px;">ØªÚ©Ø§ÛŒÛ• ÙÙ„ØªÛ•Ø±Û•Ú©Ø§Ù† Ù‡Û•ÚµØ¨Ú˜ÛØ±Û•</td></tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Ù…Û†Ø¯Ø§Ù„ÛŒ Ú¯Û•Ú•Ø§Ù†ÛŒ Ø®ÙˆÛÙ†Ø¯Ú©Ø§Ø± -->
    <div id="studentSearchModal" class="modal">
        <div class="modal-content">
            <button class="close-btn" onclick="closeStudentSearchModal()">&times;</button>
            <h2 style="clear: both; margin-bottom: 20px;">ğŸ” Ú¯Û•Ú•Ø§Ù†ÛŒ Ø®ÙˆÛÙ†Ø¯Ú©Ø§Ø±</h2>
            
            <div class="search-container">
                <div class="search-title">
                    <i class="fas fa-search"></i>
                    Ú¯Û•Ú•Ø§Ù† Ø¨Û•Ù¾ÛÛŒ Ù†Ø§Ùˆ Ùˆ Ø¦Ø§Ø³Øª Ùˆ Ú¯Ø±ÙˆÙ¾
                </div>
                
                <div class="search-filters">
                    <input type="text" id="studentNameSearch" placeholder="Ù†Ø§ÙˆÛŒ Ø®ÙˆÛÙ†Ø¯Ú©Ø§Ø±..." class="filter-select">
                    <select id="studentLevelSearch" class="filter-select">
                        <option value="">Ù‡Û•Ù…ÙˆÙˆ Ø¦Ø§Ø³ØªÛ•Ú©Ø§Ù†</option>
                        <option value="1">Ø¦Ø§Ø³ØªÛŒ 1</option>
                        <option value="2">Ø¦Ø§Ø³ØªÛŒ 2</option>
                        <option value="3">Ø¦Ø§Ø³ØªÛŒ 3</option>
                        <option value="4">Ø¦Ø§Ø³ØªÛŒ 4</option>
                        <option value="5">Ø¦Ø§Ø³ØªÛŒ 5</option>
                    </select>
                    <select id="studentGroupSearch" class="filter-select">
                        <option value="">Ù‡Û•Ù…ÙˆÙˆ Ú¯Ø±ÙˆÙˆÙ¾Û•Ú©Ø§Ù†</option>
                        <option value="A">Ú¯Ø±ÙˆÙˆÙ¾ÛŒ A</option>
                        <option value="B">Ú¯Ø±ÙˆÙˆÙ¾ÛŒ B</option>
                        <option value="C">Ú¯Ø±ÙˆÙˆÙ¾ÛŒ C</option>
                        <option value="D">Ú¯Ø±ÙˆÙˆÙ¾ÛŒ D</option>
                        <option value="E">Ú¯Ø±ÙˆÙˆÙ¾ÛŒ E</option>
                        <option value="WEB">Ú¯Ø±ÙˆÙˆÙ¾ÛŒ WEB</option>
                        <option value="NET">Ú¯Ø±ÙˆÙˆÙ¾ÛŒ NET</option>
                        <option value="PRO">Ú¯Ø±ÙˆÙˆÙ¾ÛŒ PRO</option>
                    </select>
                    <button class="action-btn" onclick="searchStudents()" style="padding: 10px 20px;">Ú¯Û•Ú•Ø§Ù†</button>
                </div>
                
                <div class="search-results" id="studentSearchResults">
                    <p style="text-align: center; padding: 20px; color: var(--gray);">
                        ğŸ” Ú¯Û•Ú•Ø§Ù†Û•Ú©Û•Øª Ø¯Û•Ø³ØªÙ¾ÛØ¨Ú©Û• Ø¨Û† Ø¨ÛŒÙ†ÛŒÙ†ÛŒ Ø¦Û•Ù†Ø¬Ø§Ù…Û•Ú©Ø§Ù†
                    </p>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Ù…Û†Ø¯Ø§Ù„ÛŒ ØªÛ†Ù…Ø§Ø±ÛŒ Ø¦ÛØ³ØªØ§ -->
    <div id="nowAttendanceModal" class="modal">
        <div class="modal-content">
            <button class="close-btn" onclick="closeNowAttendanceModal()">&times;</button>
            <h2 style="clear: both; margin-bottom: 20px;">â±ï¸ ØªÛ†Ù…Ø§Ø±ÛŒ ØºÛŒØ§Ø¨Ø§Øª Ø¨Û† Ø¦ÛØ³ØªØ§</h2>
            
            <div class="filter-container">
                <select id="nowLevel" class="filter-select" onchange="loadNowAttendanceData()">
                    <option value="">Ù‡Û•Ù…ÙˆÙˆ Ø¦Ø§Ø³ØªÛ•Ú©Ø§Ù†</option>
                    <option value="1">Ø¦Ø§Ø³ØªÛŒ 1</option>
                    <option value="2">Ø¦Ø§Ø³ØªÛŒ 2</option>
                    <option value="3">Ø¦Ø§Ø³ØªÛŒ 3</option>
                    <option value="4">Ø¦Ø§Ø³ØªÛŒ 4</option>
                    <option value="5">Ø¦Ø§Ø³ØªÛŒ 5</option>
                </select>
                <select id="nowGroup" class="filter-select" onchange="loadNowAttendanceData()">
                    <option value="">Ù‡Û•Ù…ÙˆÙˆ Ú¯Ø±ÙˆÙˆÙ¾Û•Ú©Ø§Ù†</option>
                    <option value="A">Ú¯Ø±ÙˆÙˆÙ¾ÛŒ A</option>
                    <option value="B">Ú¯Ø±ÙˆÙˆÙ¾ÛŒ B</option>
                    <option value="C">Ú¯Ø±ÙˆÙˆÙ¾ÛŒ C</option>
                    <option value="D">Ú¯Ø±ÙˆÙˆÙ¾ÛŒ D</option>
                    <option value="E">Ú¯Ø±ÙˆÙˆÙ¾ÛŒ E</option>
                    <option value="WEB">Ú¯Ø±ÙˆÙˆÙ¾ÛŒ WEB</option>
                    <option value="NET">Ú¯Ø±ÙˆÙˆÙ¾ÛŒ NET</option>
                    <option value="PRO">Ú¯Ø±ÙˆÙˆÙ¾ÛŒ PRO</option>
                </select>
                <button class="export-btn" onclick="exportNowAttendance()">ğŸ“¥ Ù‡Û•Ù†Ø§Ø±Ø¯Û•</button>
                <button class="print-btn" onclick="printNowAttendance()">ğŸ–¨ï¸ Ú†Ø§Ù¾</button>
            </div>
            
            <div class="table-container">
                <table id="nowAttendanceTable">
                    <thead>
                        <tr>
                            <th>Ù†Ø§ÙˆÛŒ Ø®ÙˆÛÙ†Ø¯Ú©Ø§Ø±</th>
                            <th>Ú©Û†Ø¯</th>
                            <th>Ù¾Û•ÛŒÙ…Ø§Ù†Ú¯Û•</th>
                            <th>Ø¦Ø§Ø³Øª</th>
                            <th>Ú¯Ø±ÙˆÙˆÙ¾</th>
                            <th>Ú©Û†ÛŒ ØºÛŒØ§Ø¨Ø§Øª</th>
                            <th>Ú©Ø±Ø¯Ø§Ø±Û•Ú©Ø§Ù†</th>
                        </tr>
                    </thead>
                    <tbody id="nowAttendanceTableBody">
                        <tr><td colspan="7" style="padding: 40px;">ØªÚ©Ø§ÛŒÛ• Ø¦Ø§Ø³Øª Ùˆ Ú¯Ø±ÙˆÙ¾ Ù‡Û•ÚµØ¨Ú˜ÛØ±Û•</td></tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Ù…Û†Ø¯Ø§Ù„ÛŒ Ù†ÙˆÛ Ø¨Û† Ú©Û†ÛŒ ØºÛŒØ§Ø¨Ø§ØªÛŒ Ø®ÙˆÛÙ†Ø¯Ú©Ø§Ø± -->
    <div id="studentAbsenceModal" class="modal">
        <div class="modal-content">
            <button class="close-btn" onclick="closeStudentAbsenceModal()">&times;</button>
            <h2 style="clear: both; margin-bottom: 20px;">ğŸ“Š Ú©Û†ÛŒ ØºÛŒØ§Ø¨Ø§ØªÛŒ Ø®ÙˆÛÙ†Ø¯Ú©Ø§Ø±</h2>
            
            <div class="search-container">
                <div class="search-title">
                    <i class="fas fa-user-graduate"></i>
                    Ú¯Û•Ú•Ø§Ù† Ø¨Û† Ø¨ÛŒÙ†ÛŒÙ†ÛŒ Ú©Û†ÛŒ ØºÛŒØ§Ø¨Ø§ØªÛ•Ú©Ø§Ù†ÛŒ Ø®ÙˆÛÙ†Ø¯Ú©Ø§Ø±
                </div>
                
                <div class="search-filters">
                    <input type="text" id="studentAbsenceName" placeholder="Ù†Ø§ÙˆÛŒ Ø®ÙˆÛÙ†Ø¯Ú©Ø§Ø±..." class="filter-select">
                    <select id="studentAbsenceLevel" class="filter-select">
                        <option value="">Ù‡Û•Ù…ÙˆÙˆ Ø¦Ø§Ø³ØªÛ•Ú©Ø§Ù†</option>
                        <option value="1">Ø¦Ø§Ø³ØªÛŒ 1</option>
                        <option value="2">Ø¦Ø§Ø³ØªÛŒ 2</option>
                        <option value="3">Ø¦Ø§Ø³ØªÛŒ 3</option>
                        <option value="4">Ø¦Ø§Ø³ØªÛŒ 4</option>
                        <option value="5">Ø¦Ø§Ø³ØªÛŒ 5</option>
                    </select>
                    <select id="studentAbsenceGroup" class="filter-select">
                        <option value="">Ù‡Û•Ù…ÙˆÙˆ Ú¯Ø±ÙˆÙˆÙ¾Û•Ú©Ø§Ù†</option>
                        <option value="A">Ú¯Ø±ÙˆÙˆÙ¾ÛŒ A</option>
                        <option value="B">Ú¯Ø±ÙˆÙˆÙ¾ÛŒ B</option>
                        <option value="C">Ú¯Ø±ÙˆÙˆÙ¾ÛŒ C</option>
                        <option value="D">Ú¯Ø±ÙˆÙˆÙ¾ÛŒ D</option>
                        <option value="E">Ú¯Ø±ÙˆÙˆÙ¾ÛŒ E</option>
                        <option value="WEB">Ú¯Ø±ÙˆÙˆÙ¾ÛŒ WEB</option>
                        <option value="NET">Ú¯Ø±ÙˆÙˆÙ¾ÛŒ NET</option>
                        <option value="PRO">Ú¯Ø±ÙˆÙˆÙ¾ÛŒ PRO</option>
                    </select>
                    <button class="action-btn" onclick="searchStudentAbsence()" style="padding: 10px 20px; background: var(--danger);">Ú¯Û•Ú•Ø§Ù†</button>
                </div>
                
                <div class="filter-container" style="margin-top: 15px;">
                    <input type="date" id="studentAbsenceStartDate" class="filter-select" placeholder="Ø¨Û•Ø±ÙˆØ§Ø±ÛŒ Ø¯Û•Ø³ØªÙ¾ÛÚ©">
                    <input type="date" id="studentAbsenceEndDate" class="filter-select" placeholder="Ø¨Û•Ø±ÙˆØ§Ø±ÛŒ Ú©Û†ØªØ§ÛŒÛŒ">
                    <button class="export-btn" onclick="exportStudentAbsence()">ğŸ“¥ Ù‡Û•Ù†Ø§Ø±Ø¯Û•</button>
                    <button class="print-btn" onclick="printStudentAbsence()">ğŸ–¨ï¸ Ú†Ø§Ù¾</button>
                </div>
                
                <div class="attendance-details-stats" id="studentAbsenceStats" style="display: none;">
                    <div class="detail-stat-card detail-stat-total"><div class="detail-stat-number" id="totalStudentsFound">0</div><div>Ú©Û†ÛŒ Ø®ÙˆÛÙ†Ø¯Ú©Ø§Ø±Û•Ú©Ø§Ù†</div></div>
                    <div class="detail-stat-card detail-stat-absent"><div class="detail-stat-number" id="totalAbsencesFound">0</div><div>Ú©Û†ÛŒ ØºÛŒØ§Ø¨Ø§Øª</div></div>
                    <div class="detail-stat-card detail-stat-present"><div class="detail-stat-number" id="averageAbsences">0</div><div>ØªÛÚ©Ú•Ø§ÛŒ ØºÛŒØ§Ø¨Ø§Øª</div></div>
                </div>
                
                <div class="search-results" id="studentAbsenceResults">
                    <p style="text-align: center; padding: 40px; color: var(--gray);">
                        ğŸ” Ú¯Û•Ú•Ø§Ù†Û•Ú©Û•Øª Ø¯Û•Ø³ØªÙ¾ÛØ¨Ú©Û• Ø¨Û† Ø¨ÛŒÙ†ÛŒÙ†ÛŒ Ú©Û†ÛŒ ØºÛŒØ§Ø¨Ø§ØªÛ•Ú©Ø§Ù†ÛŒ Ø®ÙˆÛÙ†Ø¯Ú©Ø§Ø±
                    </p>
                </div>
            </div>
        </div>
    </div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyDummy-Key",
            authDomain: "schedules-77d76.firebaseapp.com",
            databaseURL: "https://schedules-77d76-default-rtdb.firebaseio.com",
            projectId: "schedules-77d76",
            storageBucket: "schedules-77d76.appspot.com",
            messagingSenderId: "123456789",
            appId: "1:123456789:web:dummy"
        };

        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        let currentUser = null;
        let allStudents = [];
        let allLeaves = [];
        let studentAbsenceData = [];

        // ÙÛ•Ù†Ú©Ø´Ù†ÛŒ Ù†ÙˆÛ Ø¨Û† Ú©Ø±Ø¯Ù†Û•ÙˆÛ•ÛŒ Ù…Û†Ø¯Ø§Ù„ÛŒ Ú©Û†ÛŒ ØºÛŒØ§Ø¨Ø§ØªÛŒ Ø®ÙˆÛÙ†Ø¯Ú©Ø§Ø±
        function openStudentAbsenceModal() {
            document.getElementById('studentAbsenceModal').style.display = 'flex';
            
            // Ø¯Ø§Ù†Ø§Ù†ÛŒ Ø¨Û•Ø±ÙˆØ§Ø±ÛŒ Ø¦Û•Ù…Ú•Û† Ùˆ Ø³Û•Ø±Û•ØªØ§ÛŒ Ù…Ø§Ù†Ú¯
            const today = new Date();
            const firstDay = new Date(today.getFullYear(), today.getMonth(), 1);
            
            document.getElementById('studentAbsenceStartDate').value = firstDay.toISOString().split('T')[0];
            document.getElementById('studentAbsenceEndDate').value = today.toISOString().split('T')[0];
            
            // Ù¾Ø§Ú©Ú©Ø±Ø¯Ù†Û•ÙˆÛ•ÛŒ Ù¾ÛØ´ÙˆÙˆÛŒ Ú¯Û•Ú•Ø§Ù†
            document.getElementById('studentAbsenceName').value = '';
            document.getElementById('studentAbsenceLevel').value = '';
            document.getElementById('studentAbsenceGroup').value = '';
            document.getElementById('studentAbsenceResults').innerHTML = 
                '<p style="text-align: center; padding: 40px; color: var(--gray);">ğŸ” Ú¯Û•Ú•Ø§Ù†Û•Ú©Û•Øª Ø¯Û•Ø³ØªÙ¾ÛØ¨Ú©Û• Ø¨Û† Ø¨ÛŒÙ†ÛŒÙ†ÛŒ Ú©Û†ÛŒ ØºÛŒØ§Ø¨Ø§ØªÛ•Ú©Ø§Ù†ÛŒ Ø®ÙˆÛÙ†Ø¯Ú©Ø§Ø±</p>';
            
            document.getElementById('studentAbsenceStats').style.display = 'none';
        }
        
        function closeStudentAbsenceModal() {
            document.getElementById('studentAbsenceModal').style.display = 'none';
        }
        
        // ÙÛ•Ù†Ú©Ø´Ù†ÛŒ Ø³Û•Ø±Û•Ú©ÛŒ Ø¨Û† Ú¯Û•Ú•Ø§Ù†ÛŒ Ú©Û†ÛŒ ØºÛŒØ§Ø¨Ø§ØªÛŒ Ø®ÙˆÛÙ†Ø¯Ú©Ø§Ø±
        function searchStudentAbsence() {
            const nameQuery = document.getElementById('studentAbsenceName').value.toLowerCase();
            const levelQuery = document.getElementById('studentAbsenceLevel').value;
            const groupQuery = document.getElementById('studentAbsenceGroup').value;
            const startDate = document.getElementById('studentAbsenceStartDate').value;
            const endDate = document.getElementById('studentAbsenceEndDate').value;
            
            if (!startDate || !endDate) {
                showNotification('Ù‡Û•ÚµÛ•', 'ØªÚ©Ø§ÛŒÛ• Ù‡Û•Ø±Ø¯ÙˆÙˆ Ø¨Û•Ø±ÙˆØ§Ø±ÛŒ Ø¯Û•Ø³ØªÙ¾ÛÚ© Ùˆ Ú©Û†ØªØ§ÛŒÛŒ Ù‡Û•ÚµØ¨Ú˜ÛØ±Û•!', 'error');
                return;
            }
            
            const resultsContainer = document.getElementById('studentAbsenceResults');
            resultsContainer.innerHTML = '<p style="text-align: center; padding: 40px;">Ú©Û•Ù…ÛÚ© Ú†Ø§ÙˆÛ•Ú•Û Ø¨Ú©Û•ØŒ Ø¯Ø§ØªØ§Ú©Ø§Ù† Ø¨Ø§Ø± Ø¯Û•Ú©Ø±ÛÙ†...</p>';
            
            // Ú¯Û•Ú•Ø§Ù† Ù„Û• Ù†Ø§ÙˆÛ•Ú•Û†Ú©ÛŒ Ø®ÙˆÛÙ†Ø¯Ú©Ø§Ø±Û•Ú©Ø§Ù†
            const filteredStudents = allStudents.filter(student => {
                const nameMatch = student.name.toLowerCase().includes(nameQuery);
                const levelMatch = levelQuery ? student.level === levelQuery : true;
                const groupMatch = groupQuery ? student.group === groupQuery : true;
                
                return nameMatch && levelMatch && groupMatch;
            });
            
            if (filteredStudents.length === 0) {
                resultsContainer.innerHTML = '<p style="text-align: center; padding: 40px; color: var(--gray);">Ù‡ÛŒÚ† Ø®ÙˆÛÙ†Ø¯Ú©Ø§Ø±ÛÚ© Ù†Û•Ø¯Û†Ø²Ø±Ø§ÛŒÛ•ÙˆÛ•</p>';
                document.getElementById('studentAbsenceStats').style.display = 'none';
                return;
            }
            
            // Ù‡Û•Ú˜Ù…Ø§Ø±Ú©Ø±Ø¯Ù†ÛŒ Ú©Û†ÛŒ ØºÛŒØ§Ø¨Ø§Øª Ø¨Û† Ù‡Û•Ø± Ø®ÙˆÛÙ†Ø¯Ú©Ø§Ø±ÛÚ©
            calculateStudentAbsences(filteredStudents, startDate, endDate);
        }
        
        // ÙÛ•Ù†Ú©Ø´Ù†ÛŒ Ù‡Û•Ú˜Ù…Ø§Ø±Ú©Ø±Ø¯Ù†ÛŒ Ú©Û†ÛŒ ØºÛŒØ§Ø¨Ø§Øª
        function calculateStudentAbsences(students, startDate, endDate) {
            studentAbsenceData = [];
            
            database.ref('attendance').once('value', (snapshot) => {
                const attendanceData = snapshot.val();
                
                students.forEach(student => {
                    let totalAbsences = 0;
                    const absenceDates = [];
                    
                    if (attendanceData) {
                        Object.keys(attendanceData).forEach(date => {
                            // Ù¾Ø´ØªÚ•Ø§Ø³ØªÚ©Ø±Ø¯Ù†Û•ÙˆÛ• Ú©Û• Ø¨Û•Ø±ÙˆØ§Ø±Û•Ú©Û• Ù„Û• Ù†ÛÙˆØ§Ù† Ø¨Û•Ø±ÙˆØ§Ø±ÛŒ Ø¯Û•Ø³ØªÙ¾ÛÚ© Ùˆ Ú©Û†ØªØ§ÛŒÛŒØ¯Ø§ÛŒÛ•
                            if (date >= startDate && date <= endDate) {
                                const dateData = attendanceData[date];
                                
                                Object.keys(dateData).forEach(levelGroup => {
                                    const levelGroupData = dateData[levelGroup];
                                    
                                    Object.keys(levelGroupData).forEach(subject => {
                                        const subjectData = levelGroupData[subject];
                                        
                                        Object.keys(subjectData).forEach(time => {
                                            const timeData = subjectData[time];
                                            
                                            Object.keys(timeData).forEach(teacher => {
                                                const teacherData = timeData[teacher];
                                                
                                                // Ù¾Ø´Ú©Ù†ÛŒÙ† Ø¨Û† Ø¯Û†Ø²ÛŒÙ†Û•ÙˆÛ•ÛŒ Ø¦Û•Ùˆ Ú©Ø§ØªØ§Ù†Û•ÛŒ Ø®ÙˆÛÙ†Ø¯Ú©Ø§Ø± ØºÛŒØ§Ø¨ÛŒ Ú©Ø±Ø¯ÙˆÙˆÛ•
                                                if (teacherData[student.id] === 'absent') {
                                                    totalAbsences++;
                                                    if (!absenceDates.includes(date)) {
                                                        absenceDates.push(date);
                                                    }
                                                }
                                            });
                                        });
                                    });
                                });
                            }
                        });
                    }
                    
                    studentAbsenceData.push({
                        student: student,
                        totalAbsences: totalAbsences,
                        absenceDates: absenceDates.sort()
                    });
                });
                
                displayStudentAbsenceResults();
            }).catch(error => {
                showNotification('Ù‡Û•ÚµÛ•', 'Ù‡Û•ÚµÛ• Ù„Û• Ø¨Ø§Ø±Ú©Ø±Ø¯Ù†ÛŒ Ø¯Ø§ØªØ§Ú©Ø§Ù†ÛŒ ØºÛŒØ§Ø¨Ø§Øª', 'error');
                console.error(error);
            });
        }
        
        // ÙÛ•Ù†Ú©Ø´Ù†ÛŒ Ù†ÛŒØ´Ø§Ù†Ø¯Ø§Ù†ÛŒ Ø¦Û•Ù†Ø¬Ø§Ù…Û•Ú©Ø§Ù†ÛŒ Ú©Û†ÛŒ ØºÛŒØ§Ø¨Ø§Øª
        function displayStudentAbsenceResults() {
            const resultsContainer = document.getElementById('studentAbsenceResults');
            const statsContainer = document.getElementById('studentAbsenceStats');
            const totalStudents = document.getElementById('totalStudentsFound');
            const totalAbsences = document.getElementById('totalAbsencesFound');
            const averageAbsences = document.getElementById('averageAbsences');
            
            if (studentAbsenceData.length === 0) {
                resultsContainer.innerHTML = '<p style="text-align: center; padding: 40px; color: var(--gray);">Ù‡ÛŒÚ† Ø¯Ø§ØªØ§ÛŒÛ•Ú© Ù†Û•Ø¯Û†Ø²Ø±Ø§ÛŒÛ•ÙˆÛ•</p>';
                statsContainer.style.display = 'none';
                return;
            }
            
            // Ù‡Û•Ú˜Ù…Ø§Ø±Ú©Ø±Ø¯Ù†ÛŒ Ø¦Ø§Ù…Ø§Ø±Û•Ú©Ø§Ù†
            const totalStudentsCount = studentAbsenceData.length;
            const totalAbsencesCount = studentAbsenceData.reduce((sum, item) => sum + item.totalAbsences, 0);
            const avgAbsences = totalAbsencesCount > 0 ? (totalAbsencesCount / totalStudentsCount).toFixed(1) : 0;
            
            totalStudents.textContent = totalStudentsCount;
            totalAbsences.textContent = totalAbsencesCount;
            averageAbsences.textContent = avgAbsences;
            
            statsContainer.style.display = 'grid';
            
            // Ù†ÛŒØ´Ø§Ù†Ø¯Ø§Ù†ÛŒ Ø®ÙˆÛÙ†Ø¯Ú©Ø§Ø±Û•Ú©Ø§Ù† Ø¨Û•Ù¾ÛÛŒ Ú˜Ù…Ø§Ø±Û•ÛŒ ØºÛŒØ§Ø¨Ø§Øª (Ú©Û•Ù… Ø¨Û† Ø²Û†Ø±)
            studentAbsenceData.sort((a, b) => b.totalAbsences - a.totalAbsences);
            
            let resultsHTML = '';
            
            studentAbsenceData.forEach(item => {
                const student = item.student;
                const startDate = document.getElementById('studentAbsenceStartDate').value;
                const endDate = document.getElementById('studentAbsenceEndDate').value;
                
                // Ø¯Ø§Ø¨Û•Ø´Ú©Ø±Ø¯Ù†ÛŒ Ø¨Û•Ø±ÙˆØ§Ø±Û•Ú©Ø§Ù†ÛŒ ØºÛŒØ§Ø¨Ø§Øª Ø¨Û•Ù¾ÛÛŒ Ù…Ø§Ù†Ú¯
                const absenceByMonth = {};
                item.absenceDates.forEach(date => {
                    const month = date.substring(0, 7); // YYYY-MM
                    if (!absenceByMonth[month]) {
                        absenceByMonth[month] = [];
                    }
                    absenceByMonth[month].push(date);
                });
                
                let absencePeriodsHTML = '';
                Object.keys(absenceByMonth).forEach(month => {
                    const dates = absenceByMonth[month];
                    absencePeriodsHTML += `
                        <div class="absence-period">
                            <div class="period-title">Ù…Ø§Ù†Ú¯ÛŒ ${month}</div>
                            <div class="period-absences">
                                ${dates.map(date => `<span class="absence-date">${date}</span>`).join('')}
                            </div>
                        </div>
                    `;
                });
                
                resultsHTML += `
                    <div class="student-absence-card">
                        <div class="student-absence-header">
                            <div class="student-absence-name">${student.name}</div>
                            <div class="student-absence-count">${item.totalAbsences} ØºÛŒØ§Ø¨</div>
                        </div>
                        <div class="student-absence-details">
                            <div><strong>Ú©Û†Ø¯:</strong> ${student.code}</div>
                            <div><strong>Ù¾Û•ÛŒÙ…Ø§Ù†Ú¯Û•:</strong> ${student.institute}</div>
                            <div><strong>Ø¦Ø§Ø³Øª:</strong> ${student.level}</div>
                            <div><strong>Ú¯Ø±ÙˆÙ¾:</strong> ${student.group}</div>
                        </div>
                        ${item.totalAbsences > 0 ? `
                            <div class="absence-periods">
                                ${absencePeriodsHTML}
                            </div>
                        ` : '<p style="text-align: center; color: var(--success); margin-top: 10px;">âœ… Ø¦Û•Ù… Ø®ÙˆÛÙ†Ø¯Ú©Ø§Ø±Û• Ù‡ÛŒÚ† ØºÛŒØ§Ø¨Ø§ØªÛÚ©ÛŒ Ù†ÛŒÛ• Ù„Û•Ù… Ù…Ø§ÙˆÛ•ÛŒÛ•Ø¯Ø§</p>'}
                    </div>
                `;
            });
            
            resultsContainer.innerHTML = resultsHTML;
            
            showNotification('Ø³Û•Ø±Ú©Û•ÙˆØªÙˆÙˆ', `${totalStudentsCount} Ø®ÙˆÛÙ†Ø¯Ú©Ø§Ø± Ø¯Û†Ø²Ø±Ø§ÛŒÛ•ÙˆÛ• Ø¨Û• Ú©Û†ÛŒ ${totalAbsencesCount} ØºÛŒØ§Ø¨Ø§Øª`, 'success');
        }
        
        // ÙÛ•Ù†Ú©Ø´Ù†ÛŒ Ù‡Û•Ù†Ø§Ø±Ø¯Û•Ú©Ø±Ø¯Ù†ÛŒ Ú©Û†ÛŒ ØºÛŒØ§Ø¨Ø§Øª
        function exportStudentAbsence() {
            if (studentAbsenceData.length === 0) {
                showNotification('Ù‡Û•ÚµÛ•', 'Ù‡ÛŒÚ† Ø¯Ø§ØªØ§ÛŒÛ•Ú© Ù†ÛŒÛ• Ø¨Û† Ù‡Û•Ù†Ø§Ø±Ø¯Û•Ú©Ø±Ø¯Ù†!', 'error');
                return;
            }
            
            const startDate = document.getElementById('studentAbsenceStartDate').value || 'Ù†Ø§Ø¯ÛŒØ§Ø±';
            const endDate = document.getElementById('studentAbsenceEndDate').value || 'Ù†Ø§Ø¯ÛŒØ§Ø±';
            
            const data = studentAbsenceData.map(item => ({
                'Ù†Ø§ÙˆÛŒ Ø®ÙˆÛÙ†Ø¯Ú©Ø§Ø±': item.student.name,
                'Ú©Û†Ø¯': item.student.code,
                'Ù¾Û•ÛŒÙ…Ø§Ù†Ú¯Û•': item.student.institute,
                'Ø¦Ø§Ø³Øª': item.student.level,
                'Ú¯Ø±ÙˆÙ¾': item.student.group,
                'Ú©Û†ÛŒ ØºÛŒØ§Ø¨Ø§Øª': item.totalAbsences,
                'Ø¨Û•Ø±ÙˆØ§Ø±Û•Ú©Ø§Ù†ÛŒ ØºÛŒØ§Ø¨Ø§Øª': item.absenceDates.join(', ')
            }));
            
            const ws = XLSX.utils.json_to_sheet(data);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, 'Ú©Û†ÛŒ ØºÛŒØ§Ø¨Ø§Øª');
            XLSX.writeFile(wb, `Ú©Û†ÛŒ_ØºÛŒØ§Ø¨Ø§ØªÛŒ_Ø®ÙˆÛÙ†Ø¯Ú©Ø§Ø±Ø§Ù†_${startDate}_ØªØ§_${endDate}.xlsx`);
            
            showNotification('Ø³Û•Ø±Ú©Û•ÙˆØªÙˆÙˆ', 'ÙØ§ÛŒÙ„Û•Ú©Û• Ø¨Û• Ø³Û•Ø±Ú©Û•ÙˆØªÙˆÙˆÛŒÛŒ Ù‡Û•Ù†Ø§Ø±Ø¯Û•Ú©Ø±Ø§! ğŸ“¥', 'success');
        }
        
        // ÙÛ•Ù†Ú©Ø´Ù†ÛŒ Ú†Ø§Ù¾Ú©Ø±Ø¯Ù†ÛŒ Ú©Û†ÛŒ ØºÛŒØ§Ø¨Ø§Øª
        function printStudentAbsence() {
            if (studentAbsenceData.length === 0) {
                showNotification('Ù‡Û•ÚµÛ•', 'Ù‡ÛŒÚ† Ø¯Ø§ØªØ§ÛŒÛ•Ú© Ù†ÛŒÛ• Ø¨Û† Ú†Ø§Ù¾Ú©Ø±Ø¯Ù†!', 'error');
                return;
            }
            
            const startDate = document.getElementById('studentAbsenceStartDate').value || 'Ù†Ø§Ø¯ÛŒØ§Ø±';
            const endDate = document.getElementById('studentAbsenceEndDate').value || 'Ù†Ø§Ø¯ÛŒØ§Ø±';
            const totalStudents = document.getElementById('totalStudentsFound').textContent;
            const totalAbsences = document.getElementById('totalAbsencesFound').textContent;
            const averageAbsences = document.getElementById('averageAbsences').textContent;
            
            let printContent = `
                <div class="print-header">
                    <div class="print-title">Ú©Û†ÛŒ ØºÛŒØ§Ø¨Ø§ØªÛŒ Ø®ÙˆÛÙ†Ø¯Ú©Ø§Ø±Ø§Ù†</div>
                    <div class="print-date">Ù„Û• ${startDate} ØªØ§ ${endDate}</div>
                    <div class="print-date">Ú©Ø§ØªÛŒ Ú†Ø§Ù¾: ${new Date().toLocaleString('en-GB')}</div>
                </div>
                
                <div class="attendance-details-stats" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin: 20px 0;">
                    <div class="detail-stat-card" style="text-align: center; padding: 15px; border-radius: 8px; border: 2px solid #17a2b8;">
                        <div class="detail-stat-number" style="font-size: 28px; font-weight: bold; color: #17a2b8;">${totalStudents}</div>
                        <div>Ú©Û†ÛŒ Ø®ÙˆÛÙ†Ø¯Ú©Ø§Ø±Û•Ú©Ø§Ù†</div>
                    </div>
                    <div class="detail-stat-card" style="text-align: center; padding: 15px; border-radius: 8px; border: 2px solid #dc3545;">
                        <div class="detail-stat-number" style="font-size: 28px; font-weight: bold; color: #dc3545;">${totalAbsences}</div>
                        <div>Ú©Û†ÛŒ ØºÛŒØ§Ø¨Ø§Øª</div>
                    </div>
                    <div class="detail-stat-card" style="text-align: center; padding: 15px; border-radius: 8px; border: 2px solid #28a745;">
                        <div class="detail-stat-number" style="font-size: 28px; font-weight: bold; color: #28a745;">${averageAbsences}</div>
                        <div>ØªÛÚ©Ú•Ø§ÛŒ ØºÛŒØ§Ø¨Ø§Øª</div>
                    </div>
                </div>
                
                <table style="width: 100%; border-collapse: collapse; margin-top: 20px;">
                <thead><tr style="background: #667eea; color: white;">
                    <th style="border: 1px solid #ddd; padding: 10px;">Ù†Ø§ÙˆÛŒ Ø®ÙˆÛÙ†Ø¯Ú©Ø§Ø±</th>
                    <th style="border: 1px solid #ddd; padding: 10px;">Ú©Û†Ø¯</th>
                    <th style="border: 1px solid #ddd; padding: 10px;">Ù¾Û•ÛŒÙ…Ø§Ù†Ú¯Û•</th>
                    <th style="border: 1px solid #ddd; padding: 10px;">Ø¦Ø§Ø³Øª</th>
                    <th style="border: 1px solid #ddd; padding: 10px;">Ú¯Ø±ÙˆÙˆÙ¾</th>
                    <th style="border: 1px solid #ddd; padding: 10px;">Ú©Û†ÛŒ ØºÛŒØ§Ø¨Ø§Øª</th>
                </tr></thead><tbody>`;
            
            studentAbsenceData.forEach(item => {
                printContent += `
                    <tr>
                        <td style="border: 1px solid #ddd; padding: 8px; text-align: center;">${item.student.name}</td>
                        <td style="border: 1px solid #ddd; padding: 8px; text-align: center;">${item.student.code}</td>
                        <td style="border: 1px solid #ddd; padding: 8px; text-align: center;">${item.student.institute}</td>
                        <td style="border: 1px solid #ddd; padding: 8px; text-align: center;">${item.student.level}</td>
                        <td style="border: 1px solid #ddd; padding: 8px; text-align: center;">${item.student.group}</td>
                        <td style="border: 1px solid #ddd; padding: 8px; text-align: center; font-weight: bold; color: #dc3545;">${item.totalAbsences}</td>
                    </tr>
                `;
            });
            
            printContent += '</tbody></table>';
            
            improvedPrint(printContent, "Ú©Û†ÛŒ ØºÛŒØ§Ø¨Ø§ØªÛŒ Ø®ÙˆÛÙ†Ø¯Ú©Ø§Ø±Ø§Ù†");
        }

        // ÙÛ•Ù†Ú©Ø´Ù†ÛŒ Ú†Ø§Ù¾ÛŒ Ø¨Ø§Ø´ØªØ± Ø¨Û† Ù‡Û•Ù…ÙˆÙˆ Ø¦Ø§Ù…ÛØ±Û•Ú©Ø§Ù†
        function improvedPrint(content, title = "Ù¾Û•Ú•Û•ÛŒ Ú†Ø§Ù¾") {
            const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
            
            if (isMobile) {
                showMobilePrintHelp();
                const blob = new Blob([`
                    <!DOCTYPE html>
                    <html dir="rtl">
                    <head>
                        <meta charset="UTF-8">
                        <meta name="viewport" content="width=device-width, initial-scale=1.0">
                        <title>${title}</title>
                        <style>
                            body { 
                                font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
                                margin: 20px; 
                                line-height: 1.6;
                                direction: rtl;
                            }
                            table { width: 100%; border-collapse: collapse; margin: 10px 0; }
                            th, td { border: 1px solid #ddd; padding: 8px; text-align: center; }
                            th { background-color: #667eea; color: white; }
                            .print-header { text-align: center; margin-bottom: 20px; border-bottom: 2px solid #667eea; padding-bottom: 15px; }
                            .print-title { font-size: 24px; font-weight: bold; margin-bottom: 10px; color: #667eea; }
                            .print-date { color: #666; margin-bottom: 5px; }
                            .teacher-section { margin-bottom: 20px; padding: 15px; border: 1px solid #ddd; border-radius: 8px; }
                            .teacher-header { display: flex; justify-content: space-between; margin-bottom: 10px; padding-bottom: 8px; border-bottom: 1px solid #eee; }
                            .teacher-name { font-size: 18px; font-weight: bold; color: #667eea; }
                            .class-record { margin: 8px 0; padding: 10px; background: #f8f9fa; border-radius: 5px; }
                            .time-slot-card { margin-bottom: 15px; padding: 12px; border: 1px solid #ddd; border-radius: 8px; border-left: 4px solid #667eea; }
                            .time-slot-header { display: flex; justify-content: space-between; margin-bottom: 8px; padding-bottom: 6px; border-bottom: 1px solid #eee; }
                            @media print {
                                body { margin: 0; padding: 15px; }
                                .no-print { display: none !important; }
                            }
                        </style>
                    </head>
                    <body>
                        ${content}
                    </body>
                    </html>
                `], { type: 'text/html' });
                
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `${title}_${new Date().toISOString().split('T')[0]}.html`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
            } else {
                const printWindow = window.open('', '_blank');
                printWindow.document.write(`
                    <!DOCTYPE html>
                    <html dir="rtl">
                    <head>
                        <meta charset="UTF-8">
                        <title>${title}</title>
                        <style>
                            body { 
                                font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
                                margin: 20px; 
                                line-height: 1.6;
                                direction: rtl;
                            }
                            table { width: 100%; border-collapse: collapse; margin: 10px 0; }
                            th, td { border: 1px solid #ddd; padding: 8px; text-align: center; }
                            th { background-color: #667eea; color: white; }
                            .print-header { text-align: center; margin-bottom: 20px; border-bottom: 2px solid #667eea; padding-bottom: 15px; }
                            .print-title { font-size: 24px; font-weight: bold; margin-bottom: 10px; color: #667eea; }
                            .print-date { color: #666; margin-bottom: 5px; }
                            .teacher-section { margin-bottom: 20px; padding: 15px; border: 1px solid #ddd; border-radius: 8px; }
                            .teacher-header { display: flex; justify-content: space-between; margin-bottom: 10px; padding-bottom: 8px; border-bottom: 1px solid #eee; }
                            .teacher-name { font-size: 18px; font-weight: bold; color: #667eea; }
                            .class-record { margin: 8px 0; padding: 10px; background: #f8f9fa; border-radius: 5px; }
                            .time-slot-card { margin-bottom: 15px; padding: 12px; border: 1px solid #ddd; border-radius: 8px; border-left: 4px solid #667eea; }
                            .time-slot-header { display: flex; justify-content: space-between; margin-bottom: 8px; padding-bottom: 6px; border-bottom: 1px solid #eee; }
                            @media print {
                                body { margin: 0; padding: 15px; }
                                .no-print { display: none !important; }
                            }
                        </style>
                    </head>
                    <body>
                        ${content}
                        <script>
                            setTimeout(() => {
                                window.print();
                            }, 500);
                        <\/script>
                    </body>
                    </html>
                `);
                printWindow.document.close();
            }
        }

        function showMobilePrintHelp() {
            showNotification(
                "Ú•ÛÙ†Ù…Ø§ÛŒÛŒ Ú†Ø§Ù¾ Ø¨Û† Ù…Û†Ø¨Ø§ÛŒÙ„", 
                "ÙØ§ÛŒÙ„Û•Ú©Û• Ø¯Ø§Ú¯ÛŒØ±Ø³Ø§. ØªÚ©Ø§ÛŒÛ•: Ù¡. ÙØ§ÛŒÙ„Û•Ú©Û• Ø¨Ú©Û•Ø±Û•ÙˆÛ• Ù¢. Ù„Û• Ø¦Û•Ù¾Ù„ÛŒÚ©Û•ÛŒØ´Ù†Û•Ú©Û•Ø¯Ø§ Ú†Ø§Ù¾ÛŒ Ø¨Ú©Û• ğŸ–¨ï¸", 
                "info"
            );
        }

        // ÙÛ•Ù†Ú©Ø´Ù†Û•Ú©Ø§Ù†ÛŒ ØªØ±...
        // (Ù‡Û•Ù…ÙˆÙˆ ÙÛ•Ù†Ú©Ø´Ù†Û•Ú©Ø§Ù†ÛŒ ØªØ± ÙˆÛ•Ú© Ø®Û†ÛŒ Ø¯Û•Ù…ÛÙ†ÛØªÛ•ÙˆÛ•)

        // ÙÛ•Ù†Ú©Ø´Ù†ÛŒ ÙÙ„ØªÛ•Ø±Ú©Ø±Ø¯Ù†ÛŒ Ø®ÙˆÛÙ†Ø¯Ú©Ø§Ø±Û•Ú©Ø§Ù† Ø¨Û•Ù¾ÛÛŒ Ø¦Ø§Ø³Øª Ùˆ Ú¯Ø±ÙˆÙ¾
        function filterStudentsByLevelGroup() {
            const levelGroupValue = document.getElementById('leaveLevelGroup').value;
            const studentSelect = document.getElementById('leaveStudentId');
            
            studentSelect.innerHTML = '<option value="">Ø®ÙˆÛÙ†Ø¯Ú©Ø§Ø±ÛÚ© Ù‡Û•ÚµØ¨Ú˜ÛØ±Û•</option>';
            
            if (!levelGroupValue) return;
            
            const [level, group] = levelGroupValue.split('-');
            const filteredStudents = allStudents.filter(student => 
                student.level === level && student.group === group
            );
            
            filteredStudents.forEach(student => {
                const option = document.createElement('option');
                option.value = student.id;
                option.textContent = student.name;
                studentSelect.appendChild(option);
            });
        }

        // ÙÛ•Ù†Ú©Ø´Ù†ÛŒ Ú¯Û•Ú•Ø§Ù†ÛŒ Ø®ÙˆÛÙ†Ø¯Ú©Ø§Ø±
        function openStudentSearch() {
            document.getElementById('studentSearchModal').style.display = 'flex';
            document.getElementById('studentNameSearch').value = '';
            document.getElementById('studentLevelSearch').value = '';
            document.getElementById('studentGroupSearch').value = '';
            document.getElementById('studentSearchResults').innerHTML = 
                '<p style="text-align: center; padding: 20px; color: var(--gray);">ğŸ” Ú¯Û•Ú•Ø§Ù†Û•Ú©Û•Øª Ø¯Û•Ø³ØªÙ¾ÛØ¨Ú©Û• Ø¨Û† Ø¨ÛŒÙ†ÛŒÙ†ÛŒ Ø¦Û•Ù†Ø¬Ø§Ù…Û•Ú©Ø§Ù†</p>';
        }
        
        function closeStudentSearchModal() {
            document.getElementById('studentSearchModal').style.display = 'none';
        }
        
        function searchStudents() {
            const nameQuery = document.getElementById('studentNameSearch').value.toLowerCase();
            const levelQuery = document.getElementById('studentLevelSearch').value;
            const groupQuery = document.getElementById('studentGroupSearch').value;
            
            const resultsContainer = document.getElementById('studentSearchResults');
            resultsContainer.innerHTML = '<p style="text-align: center; padding: 20px;">Ú©Û•Ù…ÛÚ© Ú†Ø§ÙˆÛ•Ú•Û Ø¨Ú©Û•...</p>';
            
            const filteredStudents = allStudents.filter(student => {
                const nameMatch = student.name.toLowerCase().includes(nameQuery);
                const levelMatch = levelQuery ? student.level === levelQuery : true;
                const groupMatch = groupQuery ? student.group === groupQuery : true;
                
                return nameMatch && levelMatch && groupMatch;
            });
            
            displaySearchResults(filteredStudents);
        }
        
        function displaySearchResults(students) {
            const resultsContainer = document.getElementById('studentSearchResults');
            
            if (students.length === 0) {
                resultsContainer.innerHTML = '<p style="text-align: center; padding: 40px; color: var(--gray);">Ù‡ÛŒÚ† Ø®ÙˆÛÙ†Ø¯Ú©Ø§Ø±ÛÚ© Ù†Û•Ø¯Û†Ø²Ø±Ø§ÛŒÛ•ÙˆÛ•</p>';
                return;
            }
            
            let resultsHTML = '';
            
            students.forEach(student => {
                resultsHTML += `
                    <div class="student-card">
                        <div class="student-info">
                            <h4>${student.name}</h4>
                            <div class="student-details">
                                Ú©Û†Ø¯: ${student.code} | Ù¾Û•ÛŒÙ…Ø§Ù†Ú¯Û•: ${student.institute} | Ø¦Ø§Ø³Øª: ${student.level} | Ú¯Ø±ÙˆÙ¾: ${student.group}
                            </div>
                        </div>
                        <div class="student-actions">
                            <button class="action-btn-small view-btn" onclick="viewStudentDetails('${student.id}')">
                                <i class="fas fa-eye"></i> Ø¨ÛŒÙ†ÛŒÙ†
                            </button>
                            <button class="action-btn-small leave-btn" onclick="quickAddLeave('${student.id}')">
                                <i class="fas fa-umbrella-beach"></i> Ù…Û†ÚµÛ•Øª
                            </button>
                            <button class="action-btn-small now-btn" onclick="quickNowAttendance('${student.id}')">
                                <i class="fas fa-clock"></i> Ø¦ÛØ³ØªØ§
                            </button>
                        </div>
                    </div>
                `;
            });
            
            resultsContainer.innerHTML = resultsHTML;
            
            showNotification('Ú¯Û•Ú•Ø§Ù†', `${students.length} Ø®ÙˆÛÙ†Ø¯Ú©Ø§Ø± Ø¯Û†Ø²Ø±Ø§ÛŒÛ•ÙˆÛ•`, 'success');
        }
        
        function viewStudentDetails(studentId) {
            const student = allStudents.find(s => s.id === studentId);
            if (student) {
                alert(`ÙˆØ±Ø¯Û•Ú©Ø§Ø±ÛŒ Ø®ÙˆÛÙ†Ø¯Ú©Ø§Ø±:\nÙ†Ø§Ùˆ: ${student.name}\nÚ©Û†Ø¯: ${student.code}\nÙ¾Û•ÛŒÙ…Ø§Ù†Ú¯Û•: ${student.institute}\nØ¦Ø§Ø³Øª: ${student.level}\nÚ¯Ø±ÙˆÙ¾: ${student.group}`);
            }
        }
        
        function quickAddLeave(studentId) {
            const student = allStudents.find(s => s.id === studentId);
            if (student) {
                document.getElementById('leaveStudentId').value = studentId;
                document.getElementById('leaveModal').style.display = 'flex';
                closeStudentSearchModal();
            }
        }
        
        function quickNowAttendance(studentId) {
            openNowAttendanceModal();
            const student = allStudents.find(s => s.id === studentId);
            if (student) {
                document.getElementById('nowLevel').value = student.level;
                document.getElementById('nowGroup').value = student.group;
                loadNowAttendanceData();
            }
        }
        
        // ÙÛ•Ù†Ú©Ø´Ù†ÛŒ ØªÛ†Ù…Ø§Ø±ÛŒ Ø¦ÛØ³ØªØ§
        function openNowAttendanceModal() {
            document.getElementById('nowAttendanceModal').style.display = 'flex';
            loadNowAttendanceData();
        }
        
        function closeNowAttendanceModal() {
            document.getElementById('nowAttendanceModal').style.display = 'none';
        }
        
        function loadNowAttendanceData() {
            const level = document.getElementById('nowLevel').value;
            const group = document.getElementById('nowGroup').value;
            
            const tbody = document.getElementById('nowAttendanceTableBody');
            tbody.innerHTML = '<tr><td colspan="7">Ú©Û•Ù…ÛÚ© Ú†Ø§ÙˆÛ•Ú•Û Ø¨Ú©Û•...</td></tr>';
            
            const filteredStudents = allStudents.filter(student => {
                const levelMatch = level ? student.level === level : true;
                const groupMatch = group ? student.group === group : true;
                return levelMatch && groupMatch;
            });
            
            displayNowAttendanceData(filteredStudents);
        }
        
        function displayNowAttendanceData(students) {
            const tbody = document.getElementById('nowAttendanceTableBody');
            tbody.innerHTML = '';
            
            if (students.length === 0) {
                tbody.innerHTML = '<tr><td colspan="7" style="padding: 40px;">Ù‡ÛŒÚ† Ø®ÙˆÛÙ†Ø¯Ú©Ø§Ø±ÛÚ© Ù†Û•Ø¯Û†Ø²Ø±Ø§ÛŒÛ•ÙˆÛ•</td></tr>';
                return;
            }
            
            students.forEach(student => {
                const row = tbody.insertRow();
                const absenceCount = 0; // Ø¦Û•Ù…Û• Ù¾ÛÙˆÛŒØ³ØªÛ• Ù„Û• Ø¯Ø§ØªØ§Ø¨Û•ÛŒØ³Û•ÙˆÛ• ÙˆÛ•Ø±Ø¨Ú¯ÛŒØ±ÛØª
                
                row.innerHTML = `
                    <td>${student.name}</td>
                    <td>${student.code}</td>
                    <td>${student.institute}</td>
                    <td>Ø¦Ø§Ø³ØªÛŒ ${student.level}</td>
                    <td>Ú¯Ø±ÙˆÙ¾ÛŒ ${student.group}</td>
                    <td><span style="color: var(--danger); font-weight: bold;">${absenceCount}</span></td>
                    <td>
                        <button class="action-btn-small view-btn" onclick="viewStudentDetails('${student.id}')">
                            <i class="fas fa-eye"></i>
                        </button>
                        <button class="action-btn-small leave-btn" onclick="quickAddLeave('${student.id}')">
                            <i class="fas fa-umbrella-beach"></i>
                        </button>
                    </td>
                `;
            });
            
            showNotification('ØªÛ†Ù…Ø§Ø±ÛŒ Ø¦ÛØ³ØªØ§', `${students.length} Ø®ÙˆÛÙ†Ø¯Ú©Ø§Ø± Ø¯Û†Ø²Ø±Ø§ÛŒÛ•ÙˆÛ•`, 'info');
        }
        
        function exportNowAttendance() {
            showNotification('Ù‡Û•Ù†Ø§Ø±Ø¯Û•', 'Ú©Û†Ø¯ÛŒ Ù‡Û•Ù†Ø§Ø±Ø¯Û•Ú©Ø±Ø¯Ù† Ù„Û• Ú©Ø§Ø±Ø¯Ø§ÛŒÛ•', 'info');
        }
        
        function printNowAttendance() {
            showNotification('Ú†Ø§Ù¾', 'Ú©Û†Ø¯ÛŒ Ú†Ø§Ù¾Ú©Ø±Ø¯Ù† Ù„Û• Ú©Ø§Ø±Ø¯Ø§ÛŒÛ•', 'info');
        }

        // ÙÛ•Ù†Ú©Ø´Ù†Û•Ú©Ø§Ù†ÛŒ Ù…Û†ÚµÛ•Øª
        function openLeaveModal() {
            const modal = document.getElementById('leaveModal');
            const levelGroupSelect = document.getElementById('leaveLevelGroup');
            const studentSelect = document.getElementById('leaveStudentId');
            
            levelGroupSelect.innerHTML = '<option value="">Ø¦Ø§Ø³Øª Ùˆ Ú¯Ø±ÙˆÙ¾ÛÚ© Ù‡Û•ÚµØ¨Ú˜ÛØ±Û•</option>';
            studentSelect.innerHTML = '<option value="">ÛŒÛ•Ú©Û•Ù… Ø¦Ø§Ø³Øª Ùˆ Ú¯Ø±ÙˆÙ¾ Ù‡Û•ÚµØ¨Ú˜ÛØ±Û•</option>';
            
            const levelGroups = new Set();
            allStudents.forEach(student => {
                levelGroups.add(`${student.level}-${student.group}`);
            });
            
            levelGroups.forEach(levelGroup => {
                const [level, group] = levelGroup.split('-');
                const option = document.createElement('option');
                option.value = levelGroup;
                option.textContent = `Ø¦Ø§Ø³ØªÛŒ ${level} - Ú¯Ø±ÙˆÙ¾ÛŒ ${group}`;
                levelGroupSelect.appendChild(option);
            });
            
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('leaveStartDate').value = today;
            document.getElementById('leaveEndDate').value = today;
            document.getElementById('leaveRecordedBy').value = currentUser?.username || 'Ú©Ø§Ø±Ù…Û•Ù†Ø¯';
            
            modal.style.display = 'flex';
        }
        
        function closeLeaveModal() {
            document.getElementById('leaveModal').style.display = 'none';
        }
        
        function submitLeave(event) {
            event.preventDefault();
            
            const studentId = document.getElementById('leaveStudentId').value;
            const startDate = document.getElementById('leaveStartDate').value;
            const endDate = document.getElementById('leaveEndDate').value;
            const reason = document.getElementById('leaveReason').value;
            const notes = document.getElementById('leaveNotes').value;
            const recordedBy = document.getElementById('leaveRecordedBy').value;
            
            if (!studentId || !startDate || !endDate || !reason) {
                showNotification('Ù‡Û•ÚµÛ•', 'ØªÚ©Ø§ÛŒÛ• Ù‡Û•Ù…ÙˆÙˆ Ø®Ø§Ù†Û•Ú©Ø§Ù†ÛŒ Ù¾ÛÙˆÛŒØ³Øª Ù¾Ú•Ø¨Ú©Û•ÙˆÛ•!', 'error');
                return;
            }
            
            if (new Date(endDate) < new Date(startDate)) {
                showNotification('Ù‡Û•ÚµÛ•', 'Ø¨Û•Ø±ÙˆØ§Ø±ÛŒ Ú©Û†ØªØ§ÛŒÛŒ Ù†Ø§Ø¨ÛØª Ù¾ÛØ´ Ø¨Û•Ø±ÙˆØ§Ø±ÛŒ Ø¯Û•Ø³ØªÙ¾ÛÚ© Ø¨ÛØª!', 'error');
                return;
            }
            
            const student = allStudents.find(s => s.id === studentId);
            if (!student) {
                showNotification('Ù‡Û•ÚµÛ•', 'Ø®ÙˆÛÙ†Ø¯Ú©Ø§Ø± Ù†Û•Ø¯Û†Ø²Ø±Ø§ÛŒÛ•ÙˆÛ•!', 'error');
                return;
            }
            
            const days = Math.ceil((new Date(endDate) - new Date(startDate)) / (1000 * 60 * 60 * 24)) + 1;
            
            const leaveData = {
                studentId: studentId,
                studentName: student.name,
                studentCode: student.code,
                institute: student.institute,
                level: student.level,
                group: student.group,
                startDate: startDate,
                endDate: endDate,
                days: days,
                reason: reason,
                notes: notes || '',
                recordedBy: recordedBy,
                recordedAt: new Date().toISOString(),
                status: 'active'
            };
            
            const leaveRef = database.ref('leaves').push();
            leaveRef.set(leaveData).then(() => {
                showNotification('Ø³Û•Ø±Ú©Û•ÙˆØªÙˆÙˆ', `Ù…Û†ÚµÛ•ØªÛŒ ${student.name} Ø¨Û• Ø³Û•Ø±Ú©Û•ÙˆØªÙˆÙˆÛŒÛŒ ØªÛ†Ù…Ø§Ø±Ú©Ø±Ø§ Ø¨Û† ${days} Ú•Û†Ú˜! ğŸ‰`, 'success');
                closeLeaveModal();
                document.getElementById('leaveModal').querySelector('form').reset();
            }).catch(error => {
                showNotification('Ù‡Û•ÚµÛ•', 'Ù‡Û•ÚµÛ• Ù„Û• ØªÛ†Ù…Ø§Ø±Ú©Ø±Ø¯Ù†ÛŒ Ù…Û†ÚµÛ•Øª: ' + error.message, 'error');
                console.error(error);
            });
        }
        
        function viewLeaveRecords() {
            const today = new Date();
            const firstDay = new Date(today.getFullYear(), today.getMonth(), 1);
            document.getElementById('leaveFilterStartDate').value = firstDay.toISOString().split('T')[0];
            document.getElementById('leaveFilterEndDate').value = today.toISOString().split('T')[0];
            document.getElementById('leavesViewModal').style.display = 'flex';
            loadLeaveRecords();
        }
        
        function closeLeavesViewModal() {
            document.getElementById('leavesViewModal').style.display = 'none';
        }
        
        function loadLeaveRecords() {
            const startDate = document.getElementById('leaveFilterStartDate').value;
            const endDate = document.getElementById('leaveFilterEndDate').value;
            const level = document.getElementById('leaveFilterLevel').value;
            const group = document.getElementById('leaveFilterGroup').value;
            
            const tbody = document.getElementById('leavesTableBody');
            tbody.innerHTML = '<tr><td colspan="11">Ú©Û•Ù…ÛÚ© Ú†Ø§ÙˆÛ•Ú•Û Ø¨Ú©Û•...</td></tr>';
            
            database.ref('leaves').once('value', (snapshot) => {
                const data = snapshot.val();
                allLeaves = [];
                
                if (data) {
                    Object.keys(data).forEach(key => {
                        const leave = { id: key, ...data[key] };
                        
                        let include = true;
                        
                        if (startDate && leave.startDate < startDate) include = false;
                        if (endDate && leave.startDate > endDate) include = false;
                        if (level && leave.level !== level) include = false;
                        if (group && leave.group !== group) include = false;
                        
                        if (include) {
                            allLeaves.push(leave);
                        }
                    });
                }
                
                displayLeaveRecords(allLeaves);
                
                if (allLeaves.length > 0) {
                    showNotification('Ø³Û•Ø±Ú©Û•ÙˆØªÙˆÙˆ', `${allLeaves.length} ØªÛ†Ù…Ø§Ø±ÛŒ Ù…Û†ÚµÛ•Øª Ø¯Û†Ø²Ø±Ø§ÛŒÛ•ÙˆÛ•`, 'success');
                } else {
                    showNotification('Ø¦Ø§Ú¯Ø§Ø¯Ø§Ø±ÛŒ', 'Ù‡ÛŒÚ† ØªÛ†Ù…Ø§Ø±ÛÚ© Ù†Û•Ø¯Û†Ø²Ø±Ø§ÛŒÛ•ÙˆÛ•', 'info');
                }
            }).catch(error => {
                showNotification('Ù‡Û•ÚµÛ•', 'Ù‡Û•ÚµÛ• Ù„Û• Ø¨Ø§Ø±Ú©Ø±Ø¯Ù†ÛŒ Ø¯Ø§ØªØ§Ú©Ø§Ù†', 'error');
                console.error(error);
            });
        }
        
        function displayLeaveRecords(leaves) {
            const tbody = document.getElementById('leavesTableBody');
            const totalLeaves = document.getElementById('totalLeaves');
            const activeLeaves = document.getElementById('activeLeaves');
            const totalLeaveDays = document.getElementById('totalLeaveDays');
            
            tbody.innerHTML = '';
            
            if (leaves.length === 0) {
                tbody.innerHTML = '<tr><td colspan="11" style="padding: 40px;">Ù‡ÛŒÚ† ØªÛ†Ù…Ø§Ø±ÛÚ© Ù†Û•Ø¯Û†Ø²Ø±Ø§ÛŒÛ•ÙˆÛ•</td></tr>';
                totalLeaves.textContent = '0';
                activeLeaves.textContent = '0';
                totalLeaveDays.textContent = '0';
                return;
            }
            
            const today = new Date().toISOString().split('T')[0];
            let active = 0;
            let totalDays = 0;
            
            leaves.forEach(leave => {
                const isActive = leave.endDate >= today && leave.startDate <= today;
                if (isActive) active++;
                totalDays += leave.days || 0;
                
                const row = tbody.insertRow();
                row.innerHTML = `
                    <td>${leave.studentName}</td>
                    <td>${leave.institute}</td>
                    <td>Ø¦Ø§Ø³ØªÛŒ ${leave.level}</td>
                    <td>Ú¯Ø±ÙˆÙ¾ ${leave.group}</td>
                    <td>${leave.startDate}</td>
                    <td>${leave.endDate}</td>
                    <td><strong style="color: var(--primary);">${leave.days}</strong></td>
                    <td>${leave.reason}</td>
                    <td>${leave.notes || '-'}</td>
                    <td>${leave.recordedBy}</td>
                    <td class="no-print">
                        <button class="action-btn" style="padding: 6px 12px; font-size: 12px; background: var(--danger);" 
                                onclick="deleteLeave('${leave.id}')">
                            ğŸ—‘ï¸ Ø³Ú•ÛŒÙ†Û•ÙˆÛ•
                        </button>
                    </td>
                `;
                
                if (isActive) {
                    row.style.backgroundColor = 'rgba(40, 167, 69, 0.05)';
                }
            });
            
            totalLeaves.textContent = leaves.length;
            activeLeaves.textContent = active;
            totalLeaveDays.textContent = totalDays;
        }
        
        function deleteLeave(leaveId) {
            if (!confirm('Ø¯ÚµÙ†ÛŒØ§ÛŒØª Ù„Û• Ø³Ú•ÛŒÙ†Û•ÙˆÛ•ÛŒ Ø¦Û•Ù… ØªÛ†Ù…Ø§Ø±Û•ØŸ')) {
                return;
            }
            
            database.ref('leaves/' + leaveId).remove().then(() => {
                showNotification('Ø³Û•Ø±Ú©Û•ÙˆØªÙˆÙˆ', 'ØªÛ†Ù…Ø§Ø±Û•Ú©Û• Ø¨Û• Ø³Û•Ø±Ú©Û•ÙˆØªÙˆÙˆÛŒÛŒ Ø³Ú•Ø§ÛŒÛ•ÙˆÛ•', 'success');
                loadLeaveRecords();
            }).catch(error => {
                showNotification('Ù‡Û•ÚµÛ•', 'Ù‡Û•ÚµÛ• Ù„Û• Ø³Ú•ÛŒÙ†Û•ÙˆÛ•ÛŒ ØªÛ†Ù…Ø§Ø±Û•Ú©Û•', 'error');
                console.error(error);
            });
        }
        
        function exportLeaves() {
            const tbody = document.getElementById('leavesTableBody');
            const rows = tbody.getElementsByTagName('tr');
            
            if (rows.length === 1 && rows[0].cells.length === 1) {
                showNotification('Ù‡Û•ÚµÛ•', 'Ù‡ÛŒÚ† Ø¯Ø§ØªØ§ÛŒÛ•Ú© Ù†ÛŒÛ• Ø¨Û† Ù‡Û•Ù†Ø§Ø±Ø¯Û•Ú©Ø±Ø¯Ù†!', 'error');
                return;
            }
            
            const data = [];
            for (let row of rows) {
                if (row.cells.length > 1) {
                    data.push({
                        'Ù†Ø§ÙˆÛŒ Ø®ÙˆÛÙ†Ø¯Ú©Ø§Ø±': row.cells[0].textContent,
                        'Ù¾Û•ÛŒÙ…Ø§Ù†Ú¯Û•': row.cells[1].textContent,
                        'Ø¦Ø§Ø³Øª': row.cells[2].textContent,
                        'Ú¯Ø±ÙˆÙ¾': row.cells[3].textContent,
                        'Ø¨Û•Ø±ÙˆØ§Ø±ÛŒ Ø¯Û•Ø³ØªÙ¾ÛÚ©': row.cells[4].textContent,
                        'Ø¨Û•Ø±ÙˆØ§Ø±ÛŒ Ú©Û†ØªØ§ÛŒÛŒ': row.cells[5].textContent,
                        'Ú˜Ù…Ø§Ø±Û•ÛŒ Ú•Û†Ú˜Û•Ú©Ø§Ù†': row.cells[6].textContent,
                        'Ù‡Û†Ú©Ø§Ø±': row.cells[7].textContent,
                        'ØªÛØ¨ÛŒÙ†ÛŒ': row.cells[8].textContent,
                        'Ú©Ø§Ø±Ù…Û•Ù†Ø¯': row.cells[9].textContent
                    });
                }
            }
            
            const ws = XLSX.utils.json_to_sheet(data);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, 'Ù…Û†ÚµÛ•ØªÛ•Ú©Ø§Ù†');
            XLSX.writeFile(wb, `ØªÛ†Ù…Ø§Ø±ÛŒ_Ù…Û†ÚµÛ•ØªÛ•Ú©Ø§Ù†_${new Date().toISOString().split('T')[0]}.xlsx`);
            
            showNotification('Ø³Û•Ø±Ú©Û•ÙˆØªÙˆÙˆ', 'ÙØ§ÛŒÙ„Û•Ú©Û• Ø¨Û• Ø³Û•Ø±Ú©Û•ÙˆØªÙˆÙˆÛŒÛŒ Ù‡Û•Ù†Ø§Ø±Ø¯Û•Ú©Ø±Ø§! ğŸ“¥', 'success');
        }
        
        function printLeaves() {
            const tbody = document.getElementById('leavesTableBody');
            const rows = tbody.getElementsByTagName('tr');
            
            if (rows.length === 1 && rows[0].cells.length === 1) {
                showNotification('Ù‡Û•ÚµÛ•', 'Ù‡ÛŒÚ† Ø¯Ø§ØªØ§ÛŒÛ•Ú© Ù†ÛŒÛ• Ø¨Û† Ú†Ø§Ù¾Ú©Ø±Ø¯Ù†!', 'error');
                return;
            }
            
            const startDate = document.getElementById('leaveFilterStartDate').value || 'Ù†Ø§Ø¯ÛŒØ§Ø±';
            const endDate = document.getElementById('leaveFilterEndDate').value || 'Ù†Ø§Ø¯ÛŒØ§Ø±';
            const totalLeaves = document.getElementById('totalLeaves').textContent;
            const activeLeaves = document.getElementById('activeLeaves').textContent;
            const totalLeaveDays = document.getElementById('totalLeaveDays').textContent;
            
            let tableHTML = `
                <div class="attendance-details-stats" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin: 20px 0;">
                    <div class="detail-stat-card" style="text-align: center; padding: 15px; border-radius: 8px; border: 2px solid #17a2b8;">
                        <div class="detail-stat-number" style="font-size: 28px; font-weight: bold; color: #17a2b8;">${totalLeaves}</div>
                        <div>Ú©Û†ÛŒ Ù…Û†ÚµÛ•ØªÛ•Ú©Ø§Ù†</div>
                    </div>
                    <div class="detail-stat-card" style="text-align: center; padding: 15px; border-radius: 8px; border: 2px solid #28a745;">
                        <div class="detail-stat-number" style="font-size: 28px; font-weight: bold; color: #28a745;">${activeLeaves}</div>
                        <div>Ù…Û†ÚµÛ•ØªÛŒ Ú†Ø§Ù„Ø§Ú©</div>
                    </div>
                    <div class="detail-stat-card" style="text-align: center; padding: 15px; border-radius: 8px; border: 2px solid #667eea;">
                        <div class="detail-stat-number" style="font-size: 28px; font-weight: bold; color: #667eea;">${totalLeaveDays}</div>
                        <div>Ú©Û†ÛŒ Ú•Û†Ú˜Û•Ú©Ø§Ù†</div>
                    </div>
                </div>
                
                <table style="width: 100%; border-collapse: collapse; margin-top: 20px;">
                <thead><tr style="background: #667eea; color: white;">
                    <th style="border: 1px solid #ddd; padding: 10px;">Ù†Ø§ÙˆÛŒ Ø®ÙˆÛÙ†Ø¯Ú©Ø§Ø±</th>
                    <th style="border: 1px solid #ddd; padding: 10px;">Ù¾Û•ÛŒÙ…Ø§Ù†Ú¯Û•</th>
                    <th style="border: 1px solid #ddd; padding: 10px;">Ø¦Ø§Ø³Øª</th>
                    <th style="border: 1px solid #ddd; padding: 10px;">Ú¯Ø±ÙˆÙ¾</th>
                    <th style="border: 1px solid #ddd; padding: 10px;">Ø¨Û•Ø±ÙˆØ§Ø±ÛŒ Ø¯Û•Ø³ØªÙ¾ÛÚ©</th>
                    <th style="border: 1px solid #ddd; padding: 10px;">Ø¨Û•Ø±ÙˆØ§Ø±ÛŒ Ú©Û†ØªØ§ÛŒÛŒ</th>
                    <th style="border: 1px solid #ddd; padding: 10px;">Ú˜Ù…Ø§Ø±Û•ÛŒ Ú•Û†Ú˜Û•Ú©Ø§Ù†</th>
                    <th style="border: 1px solid #ddd; padding: 10px;">Ù‡Û†Ú©Ø§Ø±</th>
                    <th style="border: 1px solid #ddd; padding: 10px;">ØªÛØ¨ÛŒÙ†ÛŒ</th>
                    <th style="border: 1px solid #ddd; padding: 10px;">Ú©Ø§Ø±Ù…Û•Ù†Ø¯</th>
                </tr></thead><tbody>`;
            
            for (let row of rows) {
                if (row.cells.length > 1) {
                    tableHTML += '<tr>';
                    for (let i = 0; i < 10; i++) {
                        tableHTML += `<td style="border: 1px solid #ddd; padding: 8px; text-align: center;">${row.cells[i].textContent}</td>`;
                    }
                    tableHTML += '</tr>';
                }
            }
            
            tableHTML += '</tbody></table>';
            
            const printContent = `
                <div class="print-header">
                    <div class="print-title">ØªÛ†Ù…Ø§Ø±ÛŒ Ù…Û†ÚµÛ•ØªÛŒ Ø®ÙˆÛÙ†Ø¯Ú©Ø§Ø±Ø§Ù†</div>
                    <div class="print-date">Ù„Û• ${startDate} ØªØ§ ${endDate}</div>
                    <div class="print-date">Ú©Ø§ØªÛŒ Ú†Ø§Ù¾: ${new Date().toLocaleString('en-GB')}</div>
                </div>
                ${tableHTML}
            `;
            
            improvedPrint(printContent, "ØªÛ†Ù…Ø§Ø±ÛŒ Ù…Û†ÚµÛ•ØªÛ•Ú©Ø§Ù†");
        }

        function showNotification(title, message, type = 'info') {
            const notification = document.getElementById('notification');
            const notificationTitle = document.getElementById('notificationTitle');
            const notificationBody = document.getElementById('notificationBody');
            notification.classList.remove('success', 'error', 'info', 'warning');
            notification.classList.add(type);
            notificationTitle.textContent = title;
            notificationBody.textContent = message;
            notification.style.display = 'block';
            setTimeout(() => closeNotification(), 5000);
        }

        function closeNotification() {
            document.getElementById('notification').style.display = 'none';
        }

        function parseLevelGroup(levelGroup) {
            if (levelGroup.includes('WEB')) return { currentLevel: levelGroup.replace('WEB', ''), currentGroup: 'WEB' };
            if (levelGroup.includes('NET')) return { currentLevel: levelGroup.replace('NET', ''), currentGroup: 'NET' };
            if (levelGroup.includes('PRO')) return { currentLevel: levelGroup.replace('PRO', ''), currentGroup: 'PRO' };
            return { 
                currentLevel: levelGroup.substring(0, levelGroup.length - 1), 
                currentGroup: levelGroup.substring(levelGroup.length - 1) 
            };
        }

        function loadStudents() {
            database.ref('students').on('value', (snapshot) => {
                const students = snapshot.val();
                allStudents = [];
                if (students) {
                    Object.keys(students).forEach((key) => {
                        allStudents.push({ id: key, ...students[key] });
                    });
                }
            });
        }

        function loadInstituteLogo() {
            const logos = document.querySelectorAll('.institute-logo');
            
            logos.forEach(logo => {
                logo.onerror = function() {
                    console.log("Ù„Û†Ú¯Û†Ú©Û• Ù†Û•ØªÙˆØ§Ù†Ø±Ø§ Ø¨Ø§Ø±Ø¨Ú©Ø±ÛØª");
                    this.style.display = 'none';
                    const placeholder = document.createElement('div');
                    placeholder.className = 'logo-placeholder';
                    placeholder.innerHTML = '<i class="fas fa-graduation-cap"></i><span>Ù¾Û•ÛŒÙ…Ø§Ù†Ú¯Ø§ÛŒ Ú©Û†Ù…Ù¾ÛŒÙˆØªÛ•Ø±ÛŒ Ø³Ù„ÛÙ…Ø§Ù†ÛŒ</span>';
                    this.parentElement.appendChild(placeholder);
                };
                
                const testImg = new Image();
                testImg.onload = function() {
                    console.log('Ù„Û†Ú¯Û†Ú©Û• Ø¨Û• Ø³Û•Ø±Ú©Û•ÙˆØªÙˆÙˆÛŒÛŒ Ø¨Ø§Ø±Ú©Ø±Ø§');
                };
                testImg.onerror = function() {
                    console.log('Ù„Û†Ú¯Û†Ú©Û• Ù†Û•ØªÙˆØ§Ù†Ø±Ø§ Ø¨Ø§Ø±Ø¨Ú©Ø±ÛØª');
                    logo.style.display = 'none';
                    const placeholder = document.createElement('div');
                    placeholder.className = 'logo-placeholder';
                    placeholder.innerHTML = '<i class="fas fa-graduation-cap"></i><span>Ù¾Û•ÛŒÙ…Ø§Ù†Ú¯Ø§ÛŒ Ú©Û†Ù…Ù¾ÛŒÙˆØªÛ•Ø±ÛŒ Ø³Ù„ÛÙ…Ø§Ù†ÛŒ</span>';
                    logo.parentElement.appendChild(placeholder);
                };
                testImg.src = logo.src;
            });
        }

        function handleLogin(event) {
            event.preventDefault();
            const username = document.getElementById('username').value.trim();
            const password = document.getElementById('password').value.trim();
            
            if (username === 'attendance1113' && password === 'attendance1113') {
                currentUser = { username:username , type: 'staff' };
                showStaffDashboard();
                showNotification('Ø³Û•Ø±Ú©Û•ÙˆØªÙˆÙˆ', 'Ø¨Û• Ø³Û•Ø±Ú©Û•ÙˆØªÙˆÙˆÛŒÛŒ Ú†ÙˆÙˆÛŒØªÛ• Ú˜ÙˆÙˆØ±Û•ÙˆÛ•! ğŸ‰', 'success');
                return;
            }
            
            document.getElementById('errorMsg').style.display = 'block';
            showNotification('Ù‡Û•ÚµÛ•', 'Ù†Ø§ÙˆÛŒ Ø¨Û•Ú©Ø§Ø±Ù‡ÛÙ†Û•Ø± ÛŒØ§Ù† ÙˆØ´Û•ÛŒ Ù†Ù‡ÛÙ†ÛŒ Ù‡Û•ÚµÛ•ÛŒÛ•!', 'error');
            setTimeout(() => {
                document.getElementById('errorMsg').style.display = 'none';
            }, 3000);
        }

        function showStaffDashboard() {
            document.getElementById('loginPage').style.display = 'none';
            document.getElementById('staffDashboard').style.display = 'block';
            document.getElementById('staffWelcome').textContent = 'Ø¨Û•Ø®ÛØ±Ø¨ÛÛŒØª ' ;
            loadStudents();
            
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('filterDate').value = today;
            loadAttendanceData();
        }

        function loadAttendanceData() {
            const date = document.getElementById('filterDate').value;
            const level = document.getElementById('filterLevel').value;
            const group = document.getElementById('filterGroup').value;
            
            if (!date) {
                showNotification('Ø¦Ø§Ú¯Ø§Ø¯Ø§Ø±ÛŒÚ©Ø±Ø¯Ù†Û•ÙˆÛ•', 'ØªÚ©Ø§ÛŒÛ• Ø¨Û•Ø±ÙˆØ§Ø± Ù‡Û•ÚµØ¨Ú˜ÛØ±Û•!', 'warning');
                return;
            }
            
            const tbody = document.getElementById('attendanceTableBody');
            tbody.innerHTML = '<tr><td colspan="9">Ú©Û•Ù…ÛÚ© Ú†Ø§ÙˆÛ•Ú•Û Ø¨Ú©Û•...</td></tr>';
            
            database.ref('attendance/' + date).once('value', (snapshot) => {
                const data = snapshot.val();
                const records = [];
                
                const uniquePresentStudents = new Set();
                const uniqueAbsentStudents = new Set();
                
                if (data) {
                    Object.keys(data).forEach(levelGroup => {
                        const { currentLevel, currentGroup } = parseLevelGroup(levelGroup);
                        
                        if (level && currentLevel !== level) return;
                        if (group && currentGroup !== group) return;
                        
                        const levelGroupData = data[levelGroup];
                        
                        Object.keys(levelGroupData).forEach(subject => {
                            const subjectData = levelGroupData[subject];
                            
                            Object.keys(subjectData).forEach(time => {
                                const timeData = subjectData[time];
                                
                                Object.keys(timeData).forEach(teacher => {
                                    const attendance = timeData[teacher];
                                    let present = 0, absent = 0;
                                    
                                    Object.keys(attendance).forEach(studentId => {
                                        const status = attendance[studentId];
                                        if (status === 'present') {
                                            present++;
                                            uniquePresentStudents.add(studentId);
                                        }
                                        if (status === 'absent') {
                                            absent++;
                                            uniqueAbsentStudents.add(studentId);
                                        }
                                    });
                                    
                                    records.push({
                                        date, teacher, subject,
                                        level: currentLevel,
                                        group: currentGroup,
                                        time, present, absent,
                                        attendanceData: attendance
                                    });
                                });
                            });
                        });
                    });
                }
                
                displayAttendanceData(records);
                document.getElementById('totalRecords').textContent = records.length;
                document.getElementById('totalPresent').textContent = uniquePresentStudents.size;
                document.getElementById('totalAbsent').textContent = uniqueAbsentStudents.size;
                
                if (records.length > 0) {
                    showNotification('Ø³Û•Ø±Ú©Û•ÙˆØªÙˆÙˆ', `${records.length} ØªÛ†Ù…Ø§Ø± Ø¯Û†Ø²Ø±Ø§ÛŒÛ•ÙˆÛ•`, 'success');
                } else {
                    showNotification('Ø¦Ø§Ú¯Ø§Ø¯Ø§Ø±ÛŒÚ©Ø±Ø¯Ù†Û•ÙˆÛ•', 'Ù‡ÛŒÚ† ØªÛ†Ù…Ø§Ø±ÛÚ© Ù†Û•Ø¯Û†Ø²Ø±Ø§ÛŒÛ•ÙˆÛ•', 'info');
                }
            }).catch(error => {
                showNotification('Ù‡Û•ÚµÛ•', 'Ù‡Û•ÚµÛ• Ù„Û• Ø¨Ø§Ø±Ú©Ø±Ø¯Ù†ÛŒ Ø¯Ø§ØªØ§Ú©Ø§Ù†', 'error');
                console.error(error);
            });
        }

        function displayAttendanceData(data) {
            const tbody = document.getElementById('attendanceTableBody');
            tbody.innerHTML = '';
            
            if (data.length === 0) {
                tbody.innerHTML = '<tr><td colspan="9" style="padding: 40px;">Ù‡ÛŒÚ† ØªÛ†Ù…Ø§Ø±ÛÚ© Ù†Û•Ø¯Û†Ø²Ø±Ø§ÛŒÛ•ÙˆÛ•</td></tr>';
                return;
            }
            
            data.forEach(record => {
                const row = tbody.insertRow();
                row.innerHTML = `
                    <td>${record.date}</td>
                    <td>${record.teacher}</td>
                    <td>${record.subject}</td>
                    <td>Ø¦Ø§Ø³ØªÛŒ ${record.level}</td>
                    <td>Ú¯Ø±ÙˆÙ¾ÛŒ ${record.group}</td>
                    <td>${record.time}</td>
                    <td><span style="color: var(--success); font-weight: bold;">${record.present}</span></td>
                    <td><span style="color: var(--danger); font-weight: bold;">${record.absent}</span></td>
                    <td class="no-print">
                        <button class="details-btn" style="padding: 8px 14px; font-size: 13px;" 
                                onclick='viewDetails(${JSON.stringify(record).replace(/'/g, "&#39;")})'>
                            ğŸ‘ï¸ Ø¨ÛŒÙ†ÛŒÙ†
                        </button>
                    </td>
                `;
            });
        }

        function viewDetails(record) {
            const modal = document.getElementById('detailsModal');
            const title = document.getElementById('detailsTitle');
            const presentCount = document.getElementById('detailPresent');
            const absentCount = document.getElementById('detailAbsent');
            const totalCount = document.getElementById('detailTotal');
            const studentListContainer = document.getElementById('studentListContainer');
            
            title.textContent = `ÙˆØ±Ø¯Û•Ú©Ø§Ø±ÛŒ Ø¦Ø§Ù…Ø§Ø¯Û•Ø¨ÙˆÙˆÙ† - ${record.subject} - Ø¦Ø§Ø³ØªÛŒ ${record.level} Ú¯Ø±ÙˆÙ¾ÛŒ ${record.group}`;
            
            const groupStudents = allStudents.filter(s => 
                s.level === record.level && s.group === record.group
            );
            
            let presentStudents = [];
            let absentStudents = [];
            
            groupStudents.forEach(student => {
                const status = record.attendanceData[student.id] || 'present';
                if (status === 'present') {
                    presentStudents.push(student);
                } else {
                    absentStudents.push(student);
                }
            });
            
            presentCount.textContent = presentStudents.length;
            absentCount.textContent = absentStudents.length;
            totalCount.textContent = groupStudents.length;
            
            studentListContainer.innerHTML = '';
            
            if (presentStudents.length > 0) {
                const presentSection = document.createElement('div');
                presentSection.className = 'student-list';
                presentSection.innerHTML = `<h4>âœ… Ø®ÙˆÛÙ†Ø¯Ú©Ø§Ø±Ø§Ù†ÛŒ Ø¦Ø§Ù…Ø§Ø¯Û• (${presentStudents.length})</h4>`;
                
                presentStudents.forEach(student => {
                    const item = document.createElement('div');
                    item.className = 'student-item';
                    item.innerHTML = `
                        <div class="student-info">
                            <div class="student-name">${student.name}</div>
                            <div class="student-details">Ú©Û†Ø¯: ${student.code} | ${student.institute}</div>
                        </div>
                        <span class="status-badge status-present">âœ“ Ø¦Ø§Ù…Ø§Ø¯Û•</span>
                    `;
                    presentSection.appendChild(item);
                });
                
                studentListContainer.appendChild(presentSection);
            }
            
            if (absentStudents.length > 0) {
                const absentSection = document.createElement('div');
                absentSection.className = 'student-list';
                absentSection.innerHTML = `<h4>âŒ Ø®ÙˆÛÙ†Ø¯Ú©Ø§Ø±Ø§Ù†ÛŒ ØºÛŒØ§Ø¨ (${absentStudents.length})</h4>`;
                
                absentStudents.forEach(student => {
                    const item = document.createElement('div');
                    item.className = 'student-item';
                    item.innerHTML = `
                        <div class="student-info">
                            <div class="student-name">${student.name}</div>
                            <div class="student-details">Ú©Û†Ø¯: ${student.code} | ${student.institute}</div>
                        </div>
                        <span class="status-badge status-absent">âœ— ØºÛŒØ§Ø¨</span>
                    `;
                    absentSection.appendChild(item);
                });
                
                studentListContainer.appendChild(absentSection);
            }
            
            modal.style.display = 'flex';
            
            if (absentStudents.length > 0) {
                const absentNames = absentStudents.slice(0, 3).map(s => s.name).join('ØŒ ');
                const moreText = absentStudents.length > 3 ? ` Ùˆ ${absentStudents.length - 3} Ú©Û•Ø³ÛŒ ØªØ±` : '';
                showNotification(
                    'Ø®ÙˆÛÙ†Ø¯Ú©Ø§Ø±Ø§Ù†ÛŒ ØºÛŒØ§Ø¨', 
                    `${absentStudents.length} Ø®ÙˆÛÙ†Ø¯Ú©Ø§Ø± ØºÛŒØ§Ø¨Ù†: ${absentNames}${moreText}`, 
                    'warning'
                );
            }
        }

        function closeDetailsModal() {
            document.getElementById('detailsModal').style.display = 'none';
        }

        function viewTodayAttendance() {
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('filterDate').value = today;
            document.getElementById('filterLevel').value = '';
            document.getElementById('filterGroup').value = '';
            loadAttendanceData();
            showNotification('Ø¦Ø§Ú¯Ø§Ø¯Ø§Ø±ÛŒÚ©Ø±Ø¯Ù†Û•ÙˆÛ•', 'ØºÛŒØ§Ø¨Ø§ØªÛŒ Ø¦Û•Ù…Ú•Û† Ù¾ÛŒØ´Ø§Ù†Ø¯Ø±Ø§', 'info');
        }

        function viewTeachersAttendance() {
            const today = new Date().toISOString().split('T')[0];
            const modal = document.getElementById('teachersModal');
            const teachersListContainer = document.getElementById('teachersListContainer');
            
            teachersListContainer.innerHTML = '<p style="text-align: center; padding: 40px;">Ú©Û•Ù…ÛÚ© Ú†Ø§ÙˆÛ•Ú•Û Ø¨Ú©Û•...</p>';
            modal.style.display = 'flex';
            
            database.ref('attendance/' + today).once('value', (snapshot) => {
                const data = snapshot.val();
                const teachersMap = {};
                let totalRecords = 0;
                let totalUniqueAbsences = 0;
                const uniqueAbsentStudents = new Set();
                
                if (data) {
                    Object.keys(data).forEach(levelGroup => {
                        const { currentLevel, currentGroup } = parseLevelGroup(levelGroup);
                        
                        Object.keys(data[levelGroup]).forEach(subject => {
                            const subjectData = data[levelGroup][subject];
                            
                            Object.keys(subjectData).forEach(time => {
                                const timeData = subjectData[time];
                                
                                Object.keys(timeData).forEach(teacher => {
                                    const attendance = timeData[teacher];
                                    
                                    if (!teachersMap[teacher]) {
                                        teachersMap[teacher] = {
                                            records: [],
                                            totalAbsent: 0,
                                            uniqueAbsentStudents: new Set()
                                        };
                                    }
                                    
                                    let absentCount = 0;
                                    Object.keys(attendance).forEach(studentId => {
                                        if (attendance[studentId] === 'absent') {
                                            absentCount++;
                                            teachersMap[teacher].uniqueAbsentStudents.add(studentId);
                                            uniqueAbsentStudents.add(studentId);
                                        }
                                    });
                                    
                                    teachersMap[teacher].records.push({
                                        date: today,
                                        level: currentLevel,
                                        group: currentGroup,
                                        subject: subject,
                                        time: time,
                                        absentCount: absentCount
                                    });
                                    
                                    teachersMap[teacher].totalAbsent = teachersMap[teacher].uniqueAbsentStudents.size;
                                    totalRecords++;
                                });
                            });
                        });
                    });
                    
                    totalUniqueAbsences = uniqueAbsentStudents.size;
                }
                
                displayTeachersData(teachersMap, totalRecords, totalUniqueAbsences);
            }).catch(error => {
                showNotification('Ù‡Û•ÚµÛ•', 'Ù‡Û•ÚµÛ• Ù„Û• Ø¨Ø§Ø±Ú©Ø±Ø¯Ù†ÛŒ Ø¯Ø§ØªØ§Ú©Ø§Ù†', 'error');
                console.error(error);
            });
        }

        function displayTeachersData(teachersMap, totalRecords, totalAbsences) {
            const teachersListContainer = document.getElementById('teachersListContainer');
            const totalTeachers = document.getElementById('totalTeachers');
            const totalRecordsToday = document.getElementById('totalRecordsToday');
            const totalAbsencesToday = document.getElementById('totalAbsencesToday');
            
            totalTeachers.textContent = Object.keys(teachersMap).length;
            totalRecordsToday.textContent = totalRecords;
            totalAbsencesToday.textContent = totalAbsences;
            
            teachersListContainer.innerHTML = '';
            
            if (Object.keys(teachersMap).length === 0) {
                teachersListContainer.innerHTML = '<p style="text-align: center; padding: 40px;">Ù‡ÛŒÚ† Ù…Ø§Ù…Û†Ø³ØªØ§ÛŒÛ•Ú© ØªÛ†Ù…Ø§Ø±ÛŒ ØºÛŒØ§Ø¨Ø§ØªÛŒÙ†ÛŒ Ù†Û•Ù†Ø§Ø±Ø¯ÙˆÙˆÛ• Ø¦Û•Ù…Ú•Û†</p>';
                return;
            }
            
            Object.keys(teachersMap).forEach(teacher => {
                const teacherData = teachersMap[teacher];
                const teacherSection = document.createElement('div');
                teacherSection.className = 'teacher-section';
                
                teacherSection.innerHTML = `
                    <div class="teacher-header">
                        <div class="teacher-name">ğŸ‘¨â€ğŸ« ${teacher}</div>
                        <div class="teacher-stats">
                            ${teacherData.records.length} ØªÛ†Ù…Ø§Ø± | Ú©Û†ÛŒ ØºÛŒØ§Ø¨Ø§Øª: ${teacherData.totalAbsent}
                        </div>
                    </div>
                `;
                
                teacherData.records.forEach(record => {
                    const classRecord = document.createElement('div');
                    classRecord.className = 'class-record';
                    classRecord.innerHTML = `
                        <div class="class-info">
                            <div style="font-weight: bold; color: var(--dark);">${record.subject}</div>
                            <span class="absent-count">${record.absentCount} ØºÛŒØ§Ø¨</span>
                        </div>
                        <div class="class-details">
                            Ø¦Ø§Ø³ØªÛŒ ${record.level} - Ú¯Ø±ÙˆÙ¾ÛŒ ${record.group} | Ú©Ø§Øª: ${record.time} | Ø¨Û•Ø±ÙˆØ§Ø±: ${record.date}
                        </div>
                    `;
                    teacherSection.appendChild(classRecord);
                });
                
                teachersListContainer.appendChild(teacherSection);
            });
            
            showNotification(
                'Ù…Ø§Ù…Û†Ø³ØªØ§ÛŒØ§Ù†ÛŒ Ø¦Û•Ù…Ú•Û†', 
                `${Object.keys(teachersMap).length} Ù…Ø§Ù…Û†Ø³ØªØ§ ØªÛ†Ù…Ø§Ø±ÛŒ ØºÛŒØ§Ø¨Ø§ØªÛŒÙ†ÛŒ Ù†Ø§Ø±Ø¯ÙˆÙˆÛ• Ø¦Û•Ù…Ú•Û†`, 
                'info'
            );
        }

        function closeTeachersModal() {
            document.getElementById('teachersModal').style.display = 'none';
        }

        function printTeachersToday() {
            const teachersListContainer = document.getElementById('teachersListContainer');
            const teacherSections = teachersListContainer.getElementsByClassName('teacher-section');
            
            if (teacherSections.length === 0) {
                showNotification('Ù‡Û•ÚµÛ•', 'Ù‡ÛŒÚ† Ø¯Ø§ØªØ§ÛŒÛ•Ú© Ù†ÛŒÛ• Ø¨Û† Ú†Ø§Ù¾Ú©Ø±Ø¯Ù†!', 'error');
                return;
            }
            
            const totalTeachers = document.getElementById('totalTeachers').textContent;
            const totalRecordsToday = document.getElementById('totalRecordsToday').textContent;
            const totalAbsencesToday = document.getElementById('totalAbsencesToday').textContent;
            
            let printContent = `
                <div class="print-header">
                    <div class="print-title">Ù…Ø§Ù…Û†Ø³ØªØ§ÛŒØ§Ù†ÛŒ Ø¦Û•Ù…Ú•Û†</div>
                    <div class="print-date">Ú©Ø§ØªÛŒ Ú†Ø§Ù¾: ${new Date().toLocaleString('en-GB')}</div>
                </div>
                
                <div class="time-analysis-stats" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin: 20px 0;">
                    <div class="stat-card-print" style="text-align: center; padding: 15px; border-radius: 8px; border: 2px solid #17a2b8;">
                        <div class="stat-number-print" style="font-size: 28px; font-weight: bold; color: #17a2b8;">${totalTeachers}</div>
                        <div>Ú©Û†ÛŒ Ù…Ø§Ù…Û†Ø³ØªØ§Ú©Ø§Ù†</div>
                    </div>
                    <div class="stat-card-print" style="text-align: center; padding: 15px; border-radius: 8px; border: 2px solid #28a745;">
                        <div class="stat-number-print" style="font-size: 28px; font-weight: bold; color: #28a745;">${totalRecordsToday}</div>
                        <div>Ú©Û†ÛŒ ØªÛ†Ù…Ø§Ø±Û•Ú©Ø§Ù†</div>
                    </div>
                    <div class="stat-card-print" style="text-align: center; padding: 15px; border-radius: 8px; border: 2px solid #dc3545;">
                        <div class="stat-number-print" style="font-size: 28px; font-weight: bold; color: #dc3545;">${totalAbsencesToday}</div>
                        <div>Ú©Û†ÛŒ ØºÛŒØ§Ø¨Ø§Øª</div>
                    </div>
                </div>
            `;
            
            for (let section of teacherSections) {
                const teacherName = section.querySelector('.teacher-name').textContent;
                const teacherStats = section.querySelector('.teacher-stats').textContent;
                
                printContent += `
                    <div class="teacher-section-print" style="margin-bottom: 25px; padding: 15px; border: 1px solid #ddd; border-radius: 8px;">
                        <div class="teacher-header-print" style="display: flex; justify-content: space-between; margin-bottom: 10px; padding-bottom: 8px; border-bottom: 1px solid #eee;">
                            <div class="teacher-name-print" style="font-size: 18px; font-weight: bold;">${teacherName}</div>
                            <div class="teacher-stats-print">${teacherStats}</div>
                        </div>
                `;
                
                const classRecords = section.querySelectorAll('.class-record');
                classRecords.forEach(record => {
                    const classInfo = record.querySelector('.class-info').innerHTML;
                    const classDetails = record.querySelector('.class-details').textContent;
                    
                    printContent += `
                        <div class="class-record-print" style="margin: 8px 0; padding: 10px; background: #f8f9fa; border-radius: 5px;">
                            ${classInfo}
                            <div class="class-details-print" style="font-size: 13px; color: #6c757d;">${classDetails}</div>
                        </div>
                    `;
                });
                
                printContent += `</div>`;
            }
            
            improvedPrint(printContent, "Ù…Ø§Ù…Û†Ø³ØªØ§ÛŒØ§Ù†ÛŒ Ø¦Û•Ù…Ú•Û†");
        }

        function viewTotalStudentAbsence() {
            const today = new Date();
            const firstDay = new Date(today.getFullYear(), today.getMonth(), 1);
            document.getElementById('startDate').value = firstDay.toISOString().split('T')[0];
            document.getElementById('endDate').value = today.toISOString().split('T')[0];
            document.getElementById('totalAbsenceModal').style.display = 'flex';
        }

        function closeAbsenceModal() {
            document.getElementById('totalAbsenceModal').style.display = 'none';
        }

        function loadAbsenceData() {
            const startDate = document.getElementById('startDate').value;
            const endDate = document.getElementById('endDate').value;
            
            if (!startDate || !endDate) {
                showNotification('Ù‡Û•ÚµÛ•', 'ØªÚ©Ø§ÛŒÛ• Ù‡Û•Ø±Ø¯ÙˆÙˆ Ø¨Û•Ø±ÙˆØ§Ø± Ù‡Û•ÚµØ¨Ú˜ÛØ±Û•!', 'error');
                return;
            }
            
            const tbody = document.getElementById('absenceTableBody');
            tbody.innerHTML = '<tr><td colspan="5">Ú©Û•Ù…ÛÚ© Ú†Ø§ÙˆÛ•Ú•Û Ø¨Ú©Û•...</td></tr>';
            
            database.ref('attendance').once('value', (snapshot) => {
                const data = snapshot.val();
                const studentAbsenceMap = {};
                
                if (data) {
                    Object.keys(data).forEach(dateKey => {
                        if (dateKey >= startDate && dateKey <= endDate) {
                            const dateData = data[dateKey];
                            
                            Object.keys(dateData).forEach(levelGroup => {
                                const levelGroupData = dateData[levelGroup];
                                
                                Object.keys(levelGroupData).forEach(subject => {
                                    const subjectData = levelGroupData[subject];
                                    
                                    Object.keys(subjectData).forEach(time => {
                                        const timeData = subjectData[time];
                                        
                                        Object.keys(timeData).forEach(teacher => {
                                            const attendance = timeData[teacher];
                                            
                                            Object.keys(attendance).forEach(studentId => {
                                                if (attendance[studentId] === 'absent') {
                                                    const student = allStudents.find(s => s.id === studentId);
                                                    if (student) {
                                                        if (!studentAbsenceMap[student.name]) {
                                                            studentAbsenceMap[student.name] = {
                                                                student: student,
                                                                uniqueAbsenceDays: new Set(),
                                                                totalAbsences: 0
                                                            };
                                                        }
                                                        
                                                        studentAbsenceMap[student.name].uniqueAbsenceDays.add(dateKey);
                                                        studentAbsenceMap[student.name].totalAbsences = studentAbsenceMap[student.name].uniqueAbsenceDays.size;
                                                    }
                                                }
                                            });
                                        });
                                    });
                                });
                            });
                        }
                    });
                }
                
                displayAbsenceData(studentAbsenceMap);
                
                const totalAbsent = Object.keys(studentAbsenceMap).length;
                showNotification('Ø³Û•Ø±Ú©Û•ÙˆØªÙˆÙˆ', `${totalAbsent} Ø®ÙˆÛÙ†Ø¯Ú©Ø§Ø± ØºÛŒØ§Ø¨Ø§ØªÛŒØ§Ù† Ù‡Û•ÛŒÛ• Ù„Û•Ù… Ù…Û•ÙˆØ¯Ø§ÛŒÛ•Ø¯Ø§`, 'success');
            }).catch(error => {
                showNotification('Ù‡Û•ÚµÛ•', 'Ù‡Û•ÚµÛ• Ù„Û• Ø¨Ø§Ø±Ú©Ø±Ø¯Ù†ÛŒ Ø¯Ø§ØªØ§Ú©Ø§Ù†', 'error');
                console.error(error);
            });
        }

        function displayAbsenceData(absenceMap) {
            const tbody = document.getElementById('absenceTableBody');
            tbody.innerHTML = '';
            
            const sortedData = Object.values(absenceMap).sort((a, b) => b.totalAbsences - a.totalAbsences);
            
            if (sortedData.length === 0) {
                tbody.innerHTML = '<tr><td colspan="5" style="padding: 40px;">Ù‡ÛŒÚ† ØºÛŒØ§Ø¨Ø§ØªÛÚ© Ù†Û•Ø¯Û†Ø²Ø±Ø§ÛŒÛ•ÙˆÛ•</td></tr>';
                return;
            }
            
            sortedData.forEach(item => {
                const row = tbody.insertRow();
                row.innerHTML = `
                    <td>${item.student.name}</td>
                    <td>${item.student.institute}</td>
                    <td>Ø¦Ø§Ø³ØªÛŒ ${item.student.level}</td>
                    <td>Ú¯Ø±ÙˆÙ¾ÛŒ ${item.student.group}</td>
                    <td><strong style="color: #dc3545; font-size: 20px;">${item.totalAbsences}</strong></td>
                `;
            });
        }

        function exportAbsence() {
            const tbody = document.getElementById('absenceTableBody');
            const rows = tbody.getElementsByTagName('tr');
            
            if (rows.length === 1 && rows[0].cells.length === 1) {
                showNotification('Ù‡Û•ÚµÛ•', 'Ù‡ÛŒÚ† Ø¯Ø§ØªØ§ÛŒÛ•Ú© Ù†ÛŒÛ• Ø¨Û† Ù‡Û•Ù†Ø§Ø±Ø¯Û•Ú©Ø±Ø¯Ù†!', 'error');
                return;
            }
            
            const data = [];
            for (let row of rows) {
                if (row.cells.length > 1) {
                    data.push({
                        'Ù†Ø§Ùˆ': row.cells[0].textContent,
                        'Ù¾Û•ÛŒÙ…Ø§Ù†Ú¯Û•': row.cells[1].textContent,
                        'Ø¦Ø§Ø³Øª': row.cells[2].textContent,
                        'Ú¯Ø±ÙˆÙ¾': row.cells[3].textContent,
                        'Ú©Û†ÛŒ ØºÛŒØ§Ø¨Ø§Øª': row.cells[4].textContent
                    });
                }
            }
            
            const ws = XLSX.utils.json_to_sheet(data);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, 'ØºÛŒØ§Ø¨Ø§Øª');
            XLSX.writeFile(wb, 'Ú©Û†ÛŒ_ØºÛŒØ§Ø¨Ø§ØªÛŒ_Ø®ÙˆÛÙ†Ø¯Ú©Ø§Ø±Ø§Ù†.xlsx');
            
            showNotification('Ø³Û•Ø±Ú©Û•ÙˆØªÙˆÙˆ', 'ÙØ§ÛŒÙ„Û•Ú©Û• Ø¨Û• Ø³Û•Ø±Ú©Û•ÙˆØªÙˆÙˆÛŒÛŒ Ù‡Û•Ù†Ø§Ø±Ø¯Û•Ú©Ø±Ø§! ğŸ“¥', 'success');
        }

        function printAbsenceData() {
            const tbody = document.getElementById('absenceTableBody');
            const rows = tbody.getElementsByTagName('tr');
            
            if (rows.length === 1 && rows[0].cells.length === 1) {
                showNotification('Ù‡Û•ÚµÛ•', 'Ù‡ÛŒÚ† Ø¯Ø§ØªØ§ÛŒÛ•Ú© Ù†ÛŒÛ• Ø¨Û† Ú†Ø§Ù¾Ú©Ø±Ø¯Ù†!', 'error');
                return;
            }
            
            const startDate = document.getElementById('startDate').value || 'Ù†Ø§Ø¯ÛŒØ§Ø±';
            const endDate = document.getElementById('endDate').value || 'Ù†Ø§Ø¯ÛŒØ§Ø±';
            
            let tableHTML = '<table style="width: 100%; border-collapse: collapse; margin-top: 20px;">';
            tableHTML += '<thead><tr style="background: #667eea; color: white;">';
            tableHTML += '<th style="border: 1px solid #ddd; padding: 10px;">Ù†Ø§ÙˆÛŒ Ø®ÙˆÛÙ†Ø¯Ú©Ø§Ø±</th>';
            tableHTML += '<th style="border: 1px solid #ddd; padding: 10px;">Ù¾Û•ÛŒÙ…Ø§Ù†Ú¯Û•</th>';
            tableHTML += '<th style="border: 1px solid #ddd; padding: 10px;">Ø¦Ø§Ø³Øª</th>';
            tableHTML += '<th style="border: 1px solid #ddd; padding: 10px;">Ú¯Ø±ÙˆÙˆÙ¾</th>';
            tableHTML += '<th style="border: 1px solid #ddd; padding: 10px;">Ú©Û†ÛŒ ØºÛŒØ§Ø¨Ø§Øª</th>';
            tableHTML += '</tr></thead><tbody>';
            
            for (let row of rows) {
                if (row.cells.length > 1) {
                    tableHTML += '<tr>';
                    for (let i = 0; i < row.cells.length; i++) {
                        tableHTML += `<td style="border: 1px solid #ddd; padding: 8px; text-align: center;">${row.cells[i].textContent}</td>`;
                    }
                    tableHTML += '</tr>';
                }
            }
            
            tableHTML += '</tbody></table>';
            
            const printContent = `
                <div class="print-header">
                    <div class="print-title">Ú©Û†ÛŒ Ú¯Ø´ØªÛŒ ØºÛŒØ§Ø¨Ø§ØªÛŒ Ø®ÙˆÛÙ†Ø¯Ú©Ø§Ø±Ø§Ù†</div>
                    <div class="print-date">Ù„Û• ${startDate} ØªØ§ ${endDate}</div>
                    <div class="print-date">Ú©Ø§ØªÛŒ Ú†Ø§Ù¾: ${new Date().toLocaleString('en-GB')}</div>
                </div>
                ${tableHTML}
            `;
            
            improvedPrint(printContent, "Ú©Û†ÛŒ ØºÛŒØ§Ø¨Ø§ØªÛŒ Ø®ÙˆÛÙ†Ø¯Ú©Ø§Ø±Ø§Ù†");
        }

        function viewDetailedAbsence() {
            const today = new Date();
            const firstDay = new Date(today.getFullYear(), today.getMonth(), 1);
            document.getElementById('detailedStartDate').value = firstDay.toISOString().split('T')[0];
            document.getElementById('detailedEndDate').value = today.toISOString().split('T')[0];
            document.getElementById('detailedAbsenceModal').style.display = 'flex';
        }

        function closeDetailedAbsenceModal() {
            document.getElementById('detailedAbsenceModal').style.display = 'none';
        }

        function loadDetailedAbsence() {
            const startDate = document.getElementById('detailedStartDate').value;
            const endDate = document.getElementById('detailedEndDate').value;
            const level = document.getElementById('detailedLevel').value;
            const group = document.getElementById('detailedGroup').value;
            
            if (!startDate || !endDate) {
                showNotification('Ù‡Û•ÚµÛ•', 'ØªÚ©Ø§ÛŒÛ• Ù‡Û•Ø±Ø¯ÙˆÙˆ Ø¨Û•Ø±ÙˆØ§Ø± Ù‡Û•ÚµØ¨Ú˜ÛØ±Û•!', 'error');
                return;
            }
            
            const tbody = document.getElementById('detailedAbsenceTableBody');
            tbody.innerHTML = '<tr><td colspan="9">Ú©Û•Ù…ÛÚ© Ú†Ø§ÙˆÛ•Ú•Û Ø¨Ú©Û•...</td></tr>';
            
            database.ref('attendance').once('value', (snapshot) => {
                const data = snapshot.val();
                const detailedRecords = [];
                
                if (data) {
                    Object.keys(data).forEach(dateKey => {
                        if (dateKey >= startDate && dateKey <= endDate) {
                            const dateData = data[dateKey];
                            
                            Object.keys(dateData).forEach(levelGroup => {
                                const { currentLevel, currentGroup } = parseLevelGroup(levelGroup);
                                
                                if (level && currentLevel !== level) return;
                                if (group && currentGroup !== group) return;
                                
                                const levelGroupData = dateData[levelGroup];
                                
                                Object.keys(levelGroupData).forEach(subject => {
                                    const subjectData = levelGroupData[subject];
                                    
                                    Object.keys(subjectData).forEach(time => {
                                        const timeData = subjectData[time];
                                        
                                        Object.keys(timeData).forEach(teacher => {
                                            const attendance = timeData[teacher];
                                            
                                            Object.keys(attendance).forEach(studentId => {
                                                if (attendance[studentId] === 'absent') {
                                                    const student = allStudents.find(s => s.id === studentId);
                                                    if (student) {
                                                        detailedRecords.push({
                                                            studentName: student.name,
                                                            studentCode: student.code,
                                                            institute: student.institute,
                                                            level: currentLevel,
                                                            group: currentGroup,
                                                            date: dateKey,
                                                            subject: subject,
                                                            teacher: teacher,
                                                            time: time
                                                        });
                                                    }
                                                }
                                            });
                                        });
                                    });
                                });
                            });
                        }
                    });
                }
                
                displayDetailedAbsence(detailedRecords);
                showNotification('Ø³Û•Ø±Ú©Û•ÙˆØªÙˆÙˆ', `${detailedRecords.length} ØªÛ†Ù…Ø§Ø±ÛŒ ØºÛŒØ§Ø¨Ø§Øª Ø¯Û†Ø²Ø±Ø§ÛŒÛ•ÙˆÛ•`, 'success');
            }).catch(error => {
                showNotification('Ù‡Û•ÚµÛ•', 'Ù‡Û•ÚµÛ• Ù„Û• Ø¨Ø§Ø±Ú©Ø±Ø¯Ù†ÛŒ Ø¯Ø§ØªØ§Ú©Ø§Ù†', 'error');
                console.error(error);
            });
        }

        function displayDetailedAbsence(records) {
            const tbody = document.getElementById('detailedAbsenceTableBody');
            tbody.innerHTML = '';
            
            if (records.length === 0) {
                tbody.innerHTML = '<tr><td colspan="9" style="padding: 40px;">Ù‡ÛŒÚ† ØºÛŒØ§Ø¨Ø§ØªÛÚ© Ù†Û•Ø¯Û†Ø²Ø±Ø§ÛŒÛ•ÙˆÛ•</td></tr>';
                return;
            }
            
            records.forEach(record => {
                const row = tbody.insertRow();
                row.innerHTML = `
                    <td>${record.studentName}</td>
                    <td>${record.studentCode}</td>
                    <td>${record.institute}</td>
                    <td>Ø¦Ø§Ø³ØªÛŒ ${record.level}</td>
                    <td>Ú¯Ø±ÙˆÙ¾ÛŒ ${record.group}</td>
                    <td>${record.date}</td>
                    <td>${record.subject}</td>
                    <td>${record.teacher}</td>
                    <td>${record.time}</td>
                `;
            });
        }

        function exportDetailedAbsence() {
            const tbody = document.getElementById('detailedAbsenceTableBody');
            const rows = tbody.getElementsByTagName('tr');
            
            if (rows.length === 1 && rows[0].cells.length === 1) {
                showNotification('Ù‡Û•ÚµÛ•', 'Ù‡ÛŒÚ† Ø¯Ø§ØªØ§ÛŒÛ•Ú© Ù†ÛŒÛ• Ø¨Û† Ù‡Û•Ù†Ø§Ø±Ø¯Û•Ú©Ø±Ø¯Ù†!', 'error');
                return;
            }
            
            const data = [];
            for (let row of rows) {
                if (row.cells.length > 1) {
                    data.push({
                        'Ù†Ø§ÙˆÛŒ Ø®ÙˆÛÙ†Ø¯Ú©Ø§Ø±': row.cells[0].textContent,
                        'Ú©Û†Ø¯': row.cells[1].textContent,
                        'Ù¾Û•ÛŒÙ…Ø§Ù†Ú¯Û•': row.cells[2].textContent,
                        'Ø¦Ø§Ø³Øª': row.cells[3].textContent,
                        'Ú¯Ø±ÙˆÙ¾': row.cells[4].textContent,
                        'Ø¨Û•Ø±ÙˆØ§Ø±': row.cells[5].textContent,
                        'ÙˆØ§Ù†Û•': row.cells[6].textContent,
                        'Ù…Ø§Ù…Û†Ø³ØªØ§': row.cells[7].textContent,
                        'Ú©Ø§Øª': row.cells[8].textContent
                    });
                }
            }
            
            const ws = XLSX.utils.json_to_sheet(data);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, 'ÙˆØ±Ø¯Û•Ú©Ø§Ø±ÛŒ ØºÛŒØ§Ø¨Ø§Øª');
            XLSX.writeFile(wb, 'ÙˆØ±Ø¯Û•Ú©Ø§Ø±ÛŒ_ØºÛŒØ§Ø¨Ø§Øª.xlsx');
            
            showNotification('Ø³Û•Ø±Ú©Û•ÙˆØªÙˆÙˆ', 'ÙØ§ÛŒÙ„Û•Ú©Û• Ø¨Û• Ø³Û•Ø±Ú©Û•ÙˆØªÙˆÙˆÛŒÛŒ Ù‡Û•Ù†Ø§Ø±Ø¯Û•Ú©Ø±Ø§! ğŸ“¥', 'success');
        }

        function printDetailedAbsence() {
            const tbody = document.getElementById('detailedAbsenceTableBody');
            const rows = tbody.getElementsByTagName('tr');
            
            if (rows.length === 1 && rows[0].cells.length === 1) {
                showNotification('Ù‡Û•ÚµÛ•', 'Ù‡ÛŒÚ† Ø¯Ø§ØªØ§ÛŒÛ•Ú© Ù†ÛŒÛ• Ø¨Û† Ú†Ø§Ù¾Ú©Ø±Ø¯Ù†!', 'error');
                return;
            }
            
            const startDate = document.getElementById('detailedStartDate').value || 'Ù†Ø§Ø¯ÛŒØ§Ø±';
            const endDate = document.getElementById('detailedEndDate').value || 'Ù†Ø§Ø¯ÛŒØ§Ø±';
            
            let tableHTML = '<table style="width: 100%; border-collapse: collapse; margin-top: 20px;">';
            tableHTML += '<thead><tr style="background: #667eea; color: white;">';
            tableHTML += '<th style="border: 1px solid #ddd; padding: 10px;">Ù†Ø§ÙˆÛŒ Ø®ÙˆÛÙ†Ø¯Ú©Ø§Ø±</th>';
            tableHTML += '<th style="border: 1px solid #ddd; padding: 10px;">Ú©Û†Ø¯</th>';
            tableHTML += '<th style="border: 1px solid #ddd; padding: 10px;">Ù¾Û•ÛŒÙ…Ø§Ù†Ú¯Û•</th>';
            tableHTML += '<th style="border: 1px solid #ddd; padding: 10px;">Ø¦Ø§Ø³Øª</th>';
            tableHTML += '<th style="border: 1px solid #ddd; padding: 10px;">Ú¯Ø±ÙˆÙˆÙ¾</th>';
            tableHTML += '<th style="border: 1px solid #ddd; padding: 10px;">Ø¨Û•Ø±ÙˆØ§Ø±</th>';
            tableHTML += '<th style="border: 1px solid #ddd; padding: 10px;">ÙˆØ§Ù†Û•</th>';
            tableHTML += '<th style="border: 1px solid #ddd; padding: 10px;">Ù…Ø§Ù…Û†Ø³ØªØ§</th>';
            tableHTML += '<th style="border: 1px solid #ddd; padding: 10px;">Ú©Ø§Øª</th>';
            tableHTML += '</tr></thead><tbody>';
            
            for (let row of rows) {
                if (row.cells.length > 1) {
                    tableHTML += '<tr>';
                    for (let i = 0; i < row.cells.length; i++) {
                        tableHTML += `<td style="border: 1px solid #ddd; padding: 8px; text-align: center;">${row.cells[i].textContent}</td>`;
                    }
                    tableHTML += '</tr>';
                }
            }
            
            tableHTML += '</tbody></table>';
            
            const printContent = `
                <div class="print-header">
                    <div class="print-title">ÙˆØ±Ø¯Û•Ú©Ø§Ø±ÛŒ ØºÛŒØ§Ø¨Ø§ØªÛ•Ú©Ø§Ù†</div>
                    <div class="print-date">Ù„Û• ${startDate} ØªØ§ ${endDate}</div>
                    <div class="print-date">Ú©Ø§ØªÛŒ Ú†Ø§Ù¾: ${new Date().toLocaleString('en-GB')}</div>
                </div>
                ${tableHTML}
            `;
            
            improvedPrint(printContent, "ÙˆØ±Ø¯Û•Ú©Ø§Ø±ÛŒ ØºÛŒØ§Ø¨Ø§ØªÛ•Ú©Ø§Ù†");
        }

        function viewTimeAnalysis() {
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('timeAnalysisDate').value = today;
            document.getElementById('timeAnalysisModal').style.display = 'flex';
            loadTimeAnalysisData();
        }
        
        function closeTimeAnalysisModal() {
            document.getElementById('timeAnalysisModal').style.display = 'none';
        }
        
        function loadTimeAnalysisData() {
            const date = document.getElementById('timeAnalysisDate').value;
            const level = document.getElementById('timeAnalysisLevel').value;
            const group = document.getElementById('timeAnalysisGroup').value;
            
            if (!date) {
                showNotification('Ù‡Û•ÚµÛ•', 'ØªÚ©Ø§ÛŒÛ• Ø¨Û•Ø±ÙˆØ§Ø± Ù‡Û•ÚµØ¨Ú˜ÛØ±Û•!', 'error');
                return;
            }
            
            const timeBreakdownContainer = document.getElementById('timeBreakdownContainer');
            timeBreakdownContainer.innerHTML = '<p style="text-align: center; padding: 40px;">Ú©Û•Ù…ÛÚ© Ú†Ø§ÙˆÛ•Ú•Û Ø¨Ú©Û•...</p>';
            
            database.ref('attendance/' + date).once('value', (snapshot) => {
                const data = snapshot.val();
                const timeSlots = {};
                let totalAbsences = 0;
                let peakAbsenceTime = '';
                let maxAbsences = 0;
                
                if (data) {
                    Object.keys(data).forEach(levelGroup => {
                        const { currentLevel, currentGroup } = parseLevelGroup(levelGroup);
                        
                        if (level && currentLevel !== level) return;
                        if (group && currentGroup !== group) return;
                        
                        const levelGroupData = data[levelGroup];
                        
                        Object.keys(levelGroupData).forEach(subject => {
                            const subjectData = levelGroupData[subject];
                            
                            Object.keys(subjectData).forEach(time => {
                                const timeData = subjectData[time];
                                
                                Object.keys(timeData).forEach(teacher => {
                                    const attendance = timeData[teacher];
                                    
                                    if (!timeSlots[time]) {
                                        timeSlots[time] = {
                                            absentStudents: [],
                                            presentStudents: [],
                                            subject: subject,
                                            teacher: teacher,
                                            level: currentLevel,
                                            group: currentGroup
                                        };
                                    }
                                    
                                    Object.keys(attendance).forEach(studentId => {
                                        if (attendance[studentId] === 'absent') {
                                            const student = allStudents.find(s => s.id === studentId);
                                            if (student) {
                                                timeSlots[time].absentStudents.push({
                                                    name: student.name,
                                                    code: student.code,
                                                    group: student.group,
                                                    level: student.level
                                                });
                                                totalAbsences++;
                                            }
                                        }
                                    });
                                });
                            });
                        });
                    });
                    
                    Object.keys(timeSlots).forEach(time => {
                        if (timeSlots[time].absentStudents.length > maxAbsences) {
                            maxAbsences = timeSlots[time].absentStudents.length;
                            peakAbsenceTime = time;
                        }
                    });
                }
                
                displayTimeAnalysisData(timeSlots, totalAbsences, peakAbsenceTime);
                
                if (Object.keys(timeSlots).length > 0) {
                    showNotification('Ø³Û•Ø±Ú©Û•ÙˆØªÙˆÙˆ', `${totalAbsences} ØºÛŒØ§Ø¨Ø§Øª Ù„Û• ${Object.keys(timeSlots).length} Ú©Ø§ØªØ¯Ø§ Ø¯Û†Ø²Ø±Ø§ÛŒÛ•ÙˆÛ•`, 'success');
                } else {
                    showNotification('Ø¦Ø§Ú¯Ø§Ø¯Ø§Ø±ÛŒÚ©Ø±Ø¯Ù†Û•ÙˆÛ•', 'Ù‡ÛŒÚ† Ø¯Ø§ØªØ§ÛŒÛ•Ú© Ù†Û•Ø¯Û†Ø²Ø±Ø§ÛŒÛ•ÙˆÛ•', 'info');
                }
            }).catch(error => {
                showNotification('Ù‡Û•ÚµÛ•', 'Ù‡Û•ÚµÛ• Ù„Û• Ø¨Ø§Ø±Ú©Ø±Ø¯Ù†ÛŒ Ø¯Ø§ØªØ§Ú©Ø§Ù†', 'error');
                console.error(error);
            });
        }
        
        function displayTimeAnalysisData(timeSlots, totalAbsences, peakAbsenceTime) {
            const timeBreakdownContainer = document.getElementById('timeBreakdownContainer');
            const totalTimeAbsences = document.getElementById('totalTimeAbsences');
            const totalTimeSlots = document.getElementById('totalTimeSlots');
            const peakAbsenceTimeElement = document.getElementById('peakAbsenceTime');
            
            totalTimeAbsences.textContent = totalAbsences;
            totalTimeSlots.textContent = Object.keys(timeSlots).length;
            peakAbsenceTimeElement.textContent = peakAbsenceTime || '-';
            
            timeBreakdownContainer.innerHTML = '';
            
            if (Object.keys(timeSlots).length === 0) {
                timeBreakdownContainer.innerHTML = '<p style="text-align: center; padding: 40px;">Ù‡ÛŒÚ† Ø¯Ø§ØªØ§ÛŒÛ•Ú© Ù†Û•Ø¯Û†Ø²Ø±Ø§ÛŒÛ•ÙˆÛ•</p>';
                return;
            }
            
            const sortedTimes = Object.keys(timeSlots).sort();
            
            sortedTimes.forEach(time => {
                const slot = timeSlots[time];
                const timeCard = document.createElement('div');
                timeCard.className = 'time-slot-card';
                
                let studentsHTML = '';
                if (slot.absentStudents.length > 0) {
                    slot.absentStudents.forEach(student => {
                        studentsHTML += `
                            <div class="time-student-item">
                                <div>
                                    <div class="time-student-name">${student.name}</div>
                                    <div class="time-student-group">Ú©Û†Ø¯: ${student.code} | Ø¦Ø§Ø³Øª: ${student.level} | Ú¯Ø±ÙˆÙ¾: ${student.group}</div>
                                </div>
                                <span class="status-badge status-absent">ØºÛŒØ§Ø¨</span>
                            </div>
                        `;
                    });
                } else {
                    studentsHTML = '<p style="text-align: center; color: var(--gray); padding: 20px;">Ù‡ÛŒÚ† ØºÛŒØ§Ø¨ÛÚ© Ù†ÛŒÛ•</p>';
                }
                
                timeCard.innerHTML = `
                    <div class="time-slot-header">
                        <div class="time-slot-title">â° ${time}</div>
                        <div class="time-slot-count">${slot.absentStudents.length} ØºÛŒØ§Ø¨</div>
                    </div>
                    <div class="class-info" style="margin-bottom: 10px; font-size: 14px;">
                        <strong>${slot.subject}</strong> | Ù…Ø§Ù…Û†Ø³ØªØ§: ${slot.teacher}
                    </div>
                    <div class="time-slot-students">
                        ${studentsHTML}
                    </div>
                `;
                
                timeBreakdownContainer.appendChild(timeCard);
            });
        }
        
        function exportTimeAnalysis() {
            const timeBreakdownContainer = document.getElementById('timeBreakdownContainer');
            const timeCards = timeBreakdownContainer.getElementsByClassName('time-slot-card');
            
            if (timeCards.length === 0) {
                showNotification('Ù‡Û•ÚµÛ•', 'Ù‡ÛŒÚ† Ø¯Ø§ØªØ§ÛŒÛ•Ú© Ù†ÛŒÛ• Ø¨Û† Ù‡Û•Ù†Ø§Ø±Ø¯Û•Ú©Ø±Ø¯Ù†!', 'error');
                return;
            }
            
            const data = [];
            const date = document.getElementById('timeAnalysisDate').value || 'Ù†Ø§Ø¯ÛŒØ§Ø±';
            
            for (let card of timeCards) {
                const time = card.querySelector('.time-slot-title').textContent.replace('â° ', '');
                const subjectTeacher = card.querySelector('.class-info').textContent;
                const absentCount = card.querySelector('.time-slot-count').textContent;
                
                const studentItems = card.querySelectorAll('.time-student-item');
                
                if (studentItems.length > 0) {
                    studentItems.forEach(item => {
                        const studentName = item.querySelector('.time-student-name').textContent;
                        const studentDetails = item.querySelector('.time-student-group').textContent;
                        
                        data.push({
                            'Ú©Ø§Øª': time,
                            'ÙˆØ§Ù†Û•/Ù…Ø§Ù…Û†Ø³ØªØ§': subjectTeacher,
                            'Ù†Ø§ÙˆÛŒ Ø®ÙˆÛÙ†Ø¯Ú©Ø§Ø±': studentName,
                            'ÙˆØ±Ø¯Û•Ú©Ø§Ø±ÛŒ Ø®ÙˆÛÙ†Ø¯Ú©Ø§Ø±': studentDetails,
                            'ØºÛŒØ§Ø¨Ø§Øª': absentCount
                        });
                    });
                } else {
                    data.push({
                        'Ú©Ø§Øª': time,
                        'ÙˆØ§Ù†Û•/Ù…Ø§Ù…Û†Ø³ØªØ§': subjectTeacher,
                        'Ù†Ø§ÙˆÛŒ Ø®ÙˆÛÙ†Ø¯Ú©Ø§Ø±': 'Ù‡ÛŒÚ† ØºÛŒØ§Ø¨ÛÚ© Ù†ÛŒÛ•',
                        'ÙˆØ±Ø¯Û•Ú©Ø§Ø±ÛŒ Ø®ÙˆÛÙ†Ø¯Ú©Ø§Ø±': '',
                        'ØºÛŒØ§Ø¨Ø§Øª': absentCount
                    });
                }
            }
            
            const ws = XLSX.utils.json_to_sheet(data);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, 'Ø´ÛŒÚ©Ø§Ø±ÛŒ Ú©Ø§Øª');
            XLSX.writeFile(wb, `Ø´ÛŒÚ©Ø§Ø±ÛŒ_Ú©Ø§ØªÛŒ_ØºÛŒØ§Ø¨Ø§Øª_${date}.xlsx`);
            
            showNotification('Ø³Û•Ø±Ú©Û•ÙˆØªÙˆÙˆ', 'ÙØ§ÛŒÙ„Û•Ú©Û• Ø¨Û• Ø³Û•Ø±Ú©Û•ÙˆØªÙˆÙˆÛŒÛŒ Ù‡Û•Ù†Ø§Ø±Ø¯Û•Ú©Ø±Ø§! ğŸ“¥', 'success');
        }

        function printTimeAnalysis() {
            const timeBreakdownContainer = document.getElementById('timeBreakdownContainer');
            const timeCards = timeBreakdownContainer.getElementsByClassName('time-slot-card');
            
            if (timeCards.length === 0) {
                showNotification('Ù‡Û•ÚµÛ•', 'Ù‡ÛŒÚ† Ø¯Ø§ØªØ§ÛŒÛ•Ú© Ù†ÛŒÛ• Ø¨Û† Ú†Ø§Ù¾Ú©Ø±Ø¯Ù†!', 'error');
                return;
            }
            
            const date = document.getElementById('timeAnalysisDate').value || 'Ù†Ø§Ø¯ÛŒØ§Ø±';
            const totalTimeAbsences = document.getElementById('totalTimeAbsences').textContent;
            const totalTimeSlots = document.getElementById('totalTimeSlots').textContent;
            const peakAbsenceTime = document.getElementById('peakAbsenceTime').textContent;
            
            let printContent = `
                <div class="print-header">
                    <div class="print-title">Ø´ÛŒÚ©Ø§Ø±ÛŒ ØºÛŒØ§Ø¨Ø§Øª Ø¨Û•Ù¾ÛÛŒ Ú©Ø§Øª</div>
                    <div class="print-date">Ø¨Û•Ø±ÙˆØ§Ø±: ${date}</div>
                    <div class="print-date">Ú©Ø§ØªÛŒ Ú†Ø§Ù¾: ${new Date().toLocaleString('en-GB')}</div>
                </div>
                
                <div class="time-analysis-stats" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin: 20px 0;">
                    <div class="stat-card-print" style="text-align: center; padding: 15px; border-radius: 8px; border: 2px solid #17a2b8;">
                        <div class="stat-number-print" style="font-size: 28px; font-weight: bold; color: #17a2b8;">${totalTimeAbsences}</div>
                        <div>Ú©Û†ÛŒ ØºÛŒØ§Ø¨Ø§Øª</div>
                    </div>
                    <div class="stat-card-print" style="text-align: center; padding: 15px; border-radius: 8px; border: 2px solid #28a745;">
                        <div class="stat-number-print" style="font-size: 28px; font-weight: bold; color: #28a745;">${totalTimeSlots}</div>
                        <div>Ú©Û†ÛŒ Ú©Ø§ØªÛ•Ú©Ø§Ù†</div>
                    </div>
                    <div class="stat-card-print" style="text-align: center; padding: 15px; border-radius: 8px; border: 2px solid #dc3545;">
                        <div class="stat-number-print" style="font-size: 28px; font-weight: bold; color: #dc3545;">${peakAbsenceTime}</div>
                        <div>Ú©Ø§ØªÛŒ Ø²Û†Ø±ØªØ±ÛŒÙ† ØºÛŒØ§Ø¨</div>
                    </div>
                </div>
            `;
            
            for (let card of timeCards) {
                const time = card.querySelector('.time-slot-title').textContent.replace('â° ', '');
                const subjectTeacher = card.querySelector('.class-info').textContent;
                const absentCount = card.querySelector('.time-slot-count').textContent;
                
                let studentsHTML = '';
                const studentItems = card.querySelectorAll('.time-student-item');
                
                if (studentItems.length > 0) {
                    studentItems.forEach(item => {
                        const studentName = item.querySelector('.time-student-name').textContent;
                        const studentDetails = item.querySelector('.time-student-group').textContent;
                        
                        studentsHTML += `
                            <div class="time-student-item-print" style="padding: 6px 0; border-bottom: 1px solid #eee;">
                                <div>
                                    <div class="time-student-name-print" style="font-size: 14px;">${studentName}</div>
                                    <div class="time-student-group-print" style="font-size: 12px; color: #6c757d;">${studentDetails}</div>
                                </div>
                                <span class="status-badge-print" style="padding: 4px 10px; border-radius: 15px; background: rgba(220, 53, 69, 0.15); color: #dc3545; font-size: 12px; font-weight: bold;">ØºÛŒØ§Ø¨</span>
                            </div>
                        `;
                    });
                } else {
                    studentsHTML = '<p style="text-align: center; color: #6c757d; padding: 15px;">Ù‡ÛŒÚ† ØºÛŒØ§Ø¨ÛÚ© Ù†ÛŒÛ•</p>';
                }
                
                printContent += `
                    <div class="time-slot-card-print" style="margin-bottom: 15px; padding: 12px; border: 1px solid #ddd; border-radius: 8px; border-left: 4px solid #667eea;">
                        <div class="time-slot-header-print" style="display: flex; justify-content: space-between; margin-bottom: 8px; padding-bottom: 6px; border-bottom: 1px solid #eee;">
                            <div class="time-slot-title-print" style="font-weight: bold;">â° ${time}</div>
                            <div class="time-slot-count-print" style="background: #667eea; color: white; padding: 3px 8px; border-radius: 15px; font-size: 13px; font-weight: bold;">${absentCount} ØºÛŒØ§Ø¨</div>
                        </div>
                        <div class="class-info-print" style="margin-bottom: 8px; font-size: 13px;">
                            ${subjectTeacher}
                        </div>
                        <div class="time-slot-students-print">
                            ${studentsHTML}
                        </div>
                    </div>
                `;
            }
            
            improvedPrint(printContent, "Ø´ÛŒÚ©Ø§Ø±ÛŒ Ú©Ø§ØªÛŒ ØºÛŒØ§Ø¨Ø§Øª");
        }

        function refreshData() {
            loadAttendanceData();
            showNotification('Ù†ÙˆÛÚ©Ø±Ø§ÛŒÛ•ÙˆÛ•', 'Ø¯Ø§ØªØ§Ú©Ø§Ù† Ø¨Û• Ø³Û•Ø±Ú©Û•ÙˆØªÙˆÙˆÛŒÛŒ Ù†ÙˆÛÚ©Ø±Ø§Ù†Û•ÙˆÛ•! ğŸ”„', 'success');
        }

        function exportTodayToExcel() {
            const tbody = document.getElementById('attendanceTableBody');
            const rows = tbody.getElementsByTagName('tr');
            
            if (rows.length === 1 && rows[0].cells.length <= 1) {
                showNotification('Ù‡Û•ÚµÛ•', 'Ù‡ÛŒÚ† Ø¯Ø§ØªØ§ÛŒÛ•Ú© Ù†ÛŒÛ• Ø¨Û† Ù‡Û•Ù†Ø§Ø±Ø¯Û•Ú©Ø±Ø¯Ù†!', 'error');
                return;
            }
            
            const data = [];
            const date = document.getElementById('filterDate').value || 'Ù†Ø§Ø¯ÛŒØ§Ø±';
            
            for (let row of rows) {
                if (row.cells.length > 1) {
                    data.push({
                        'Ø¨Û•Ø±ÙˆØ§Ø±': row.cells[0].textContent,
                        'Ù…Ø§Ù…Û†Ø³ØªØ§': row.cells[1].textContent,
                        'ÙˆØ§Ù†Û•': row.cells[2].textContent,
                        'Ø¦Ø§Ø³Øª': row.cells[3].textContent,
                        'Ú¯Ø±ÙˆÙˆÙ¾': row.cells[4].textContent,
                        'Ú©Ø§Øª': row.cells[5].textContent,
                        'Ø¦Ø§Ù…Ø§Ø¯Û•': row.cells[6].textContent,
                        'ØºÛŒØ§Ø¨': row.cells[7].textContent
                    });
                }
            }
            
            if (data.length === 0) {
                showNotification('Ù‡Û•ÚµÛ•', 'Ù‡ÛŒÚ† Ø¯Ø§ØªØ§ÛŒÛ•Ú© Ù†ÛŒÛ•!', 'error');
                return;
            }
            
            const ws = XLSX.utils.json_to_sheet(data);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, 'ØºÛŒØ§Ø¨Ø§ØªÛŒ Ø¦Û•Ù…Ú•Û†');
            XLSX.writeFile(wb, `ØªÛ†Ù…Ø§Ø±ÛŒ_ØºÛŒØ§Ø¨Ø§Øª_${date}.xlsx`);
            
            showNotification('Ø³Û•Ø±Ú©Û•ÙˆØªÙˆÙˆ', 'ÙØ§ÛŒÙ„Û•Ú©Û• Ø¨Û• Ø³Û•Ø±Ú©Û•ÙˆØªÙˆÙˆÛŒÛŒ Ù‡Û•Ù†Ø§Ø±Ø¯Û•Ú©Ø±Ø§! ğŸ“¥', 'success');
        }
        
        function printTodayAttendance() {
            const tbody = document.getElementById('attendanceTableBody');
            const rows = tbody.getElementsByTagName('tr');
            
            if (rows.length === 1 && rows[0].cells.length <= 1) {
                showNotification('Ù‡Û•ÚµÛ•', 'Ù‡ÛŒÚ† Ø¯Ø§ØªØ§ÛŒÛ•Ú© Ù†ÛŒÛ• Ø¨Û† Ú†Ø§Ù¾Ú©Ø±Ø¯Ù†!', 'error');
                return;
            }
            
            const date = document.getElementById('filterDate').value || 'Ù†Ø§Ø¯ÛŒØ§Ø±';
            let tableHTML = '<table style="width: 100%; border-collapse: collapse; margin-top: 20px;">';
            tableHTML += '<thead><tr style="background: #667eea; color: white;">';
            tableHTML += '<th style="border: 1px solid #ddd; padding: 10px;">Ø¨Û•Ø±ÙˆØ§Ø±</th>';
            tableHTML += '<th style="border: 1px solid #ddd; padding: 10px;">Ù…Ø§Ù…Û†Ø³ØªØ§</th>';
            tableHTML += '<th style="border: 1px solid #ddd; padding: 10px;">ÙˆØ§Ù†Û•</th>';
            tableHTML += '<th style="border: 1px solid #ddd; padding: 10px;">Ø¦Ø§Ø³Øª</th>';
            tableHTML += '<th style="border: 1px solid #ddd; padding: 10px;">Ú¯Ø±ÙˆÙˆÙ¾</th>';
            tableHTML += '<th style="border: 1px solid #ddd; padding: 10px;">Ú©Ø§Øª</th>';
            tableHTML += '<th style="border: 1px solid #ddd; padding: 10px;">Ø¦Ø§Ù…Ø§Ø¯Û•</th>';
            tableHTML += '<th style="border: 1px solid #ddd; padding: 10px;">ØºÛŒØ§Ø¨</th>';
            tableHTML += '</tr></thead><tbody>';
            
            for (let row of rows) {
                if (row.cells.length > 1) {
                    tableHTML += '<tr>';
                    for (let i = 0; i < 8; i++) {
                        tableHTML += `<td style="border: 1px solid #ddd; padding: 8px; text-align: center;">${row.cells[i].textContent}</td>`;
                    }
                    tableHTML += '</tr>';
                }
            }
            
            tableHTML += '</tbody></table>';
            
            const printContent = `
                <div class="print-header">
                    <div class="print-title">ØªÛ†Ù…Ø§Ø±ÛŒ ØºÛŒØ§Ø¨Ø§Øª</div>
                    <div class="print-date">Ø¨Û•Ø±ÙˆØ§Ø±: ${date}</div>
                    <div class="print-date">Ú©Ø§ØªÛŒ Ú†Ø§Ù¾: ${new Date().toLocaleString('en-GB')}</div>
                </div>
                ${tableHTML}
            `;
            
            improvedPrint(printContent, "ØªÛ†Ù…Ø§Ø±ÛŒ ØºÛŒØ§Ø¨Ø§Øª");
        }

        function logout() {
            currentUser = null;
            document.getElementById('staffDashboard').style.display = 'none';
            document.getElementById('loginPage').style.display = 'block';
            document.getElementById('username').value = '';
            document.getElementById('password').value = '';
            showNotification('Ø¯Û•Ø±Ú†ÙˆÙˆÙ†', 'Ø¨Û• Ø³Û•Ø±Ú©Û•ÙˆØªÙˆÙˆÛŒÛŒ Ú†ÙˆÙˆÛŒØªÛ• Ø¯Û•Ø±Û•ÙˆÛ•! ğŸ‘‹', 'info');
        }

        window.onclick = function(event) {
            const modals = [
                'totalAbsenceModal', 'detailsModal', 'teachersModal', 'detailedAbsenceModal', 
                'timeAnalysisModal', 'leaveModal', 'leavesViewModal', 'studentSearchModal', 
                'nowAttendanceModal', 'studentAbsenceModal'
            ];
            modals.forEach(modalId => {
                const modal = document.getElementById(modalId);
                if (event.target === modal) {
                    modal.style.display = 'none';
                }
            });
        }

        document.addEventListener('DOMContentLoaded', function() {
            loadInstituteLogo();
            loadStudents();
        });
    </script>
</body>
</html>
